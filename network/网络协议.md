### 网络协议
来源：《极客时间》专栏之《趣谈网络协议》

主讲人：刘超


#### 协议三要素
+ 语法：一段内容符合一定的规则和格式
+ 语义：一段内容要代表某种意义
+ 顺序：先做什么，再做什么

#### 分层
复杂的程序都要分层，这是程序设计的要求。所有不能表示出层层封装含义的比喻，都是不恰当的。只要是在网络上跑的包，都是完整的。可以有下层没上层，绝对不可能有上层没有下层。

#### IP 地址
 IP （ Internet Protocol ，网络之间互连的协议）地址是一个网卡在网络世界的通讯地址，相当于我们现实世界的门牌号码。
+ A类：0+网络号7位+主机号24位，私有 IP 地址范围： 10.0.0.0 - 10.255.255.255 ，最大主机数16777214（2^24-2）
+ B类：10+网络号14位+主机号16位，私有 IP 地址范围： 172.16.0.0 - 172.31.255.255 ，最大主机数65534（2^16-2）
+ C类：110+网络号21位+主机号8位，私有 IP 地址范围： 192.168.0.0 - 192.168.255.255 ，最大主机数254（2^8-2）
+ D类：1110+多播组号28位
+ E类：11110+留待后用27位

为什么主机号个数要减2？原因是去掉一个主机号全0的地址（网络地址）和主机号全1的地址（广播地址）。

#### CIDR
 CIDR （ Classless Inter-Domain Routing ，无类别域间路由）将32位的 IP 地址一分为二，前面是网络号，后面是主机号。举例： 10.100.122.2/24 ，前24位是网络号，后8位是主机号。广播地址为： 10.100.122.255 ，子网掩码为： 255.255.255.0 。将子网掩码和 IP 地址按位与计算（ AND ），就可得到网络号。

#### MAC
 MAC （ Medium Access Control ，媒体访问控制）地址，是一个网卡的物理地址，用十六进制， 6 个 byte 表示。 MAC 地址更像是身份证，是一个唯一的标识。 IP 是地址，有定位功能； MAC 是身份证，无定位功能。 MAC 层是用来解决多路访问的堵车问题的。


#### DHCP
 DHCP （ Dynamic Host Configuration Protocol ，动态主机配置协议）主要作用是集中的管理、分配 IP 地址。新来的机器使用  IP  地址  0.0.0.0  发送了一个广播包，目的  IP  地址为  255.255.255.255 。广播包封装在  UDP  里面， UDP  封装在  BOOTP  里面。其实  DHCP  是  BOOTP  的增强版，但是如果你去抓包的话，很可能看到的名称还是  BOOTP  协议。

#### Hub
和交换机不同， Hub （集线器）没有大脑，它完全在物理层工作。它会将自己收到的每一个字节，都复制到其他端口上去。交换机是有  MAC  地址学习能力的，学完了它就知道谁在哪儿了，用广播了。

#### ARP
 ARP （ Address Resolution Protocol ，地址解析协议），也就是已知  IP  地址，求 MAC 地址的协议。

#### STP
当交换机的数目越来越多的时候，会遭遇环路问题，让网络包迷路，这就需要使用 STP 协议，通过华山论剑比武的方式，将有环路的图变成没有环路的树，从而解决环路问题。 STP （ Spanning Tree Protocol ，生成树协议）主要功能有两个：一是在利用生成树算法，在以太网络中，创建一个以某台交换机的某个端口为根的生成树，避免环路。二是在以太网络拓扑发生变化时，通过生成树协议达到收敛保护的目的。

#### VLAN
交换机数目多会面临隔离问题，可以通过 VLAN 形成虚拟局域网，从而解决广播问题和安全问题。 VLAN （ Virtual Local Area Network ，虚拟局域网）是为解决以太网的广播问题和安全性而提出的一种协议，它在以太网帧的基础上增加了 VLAN 头，用 VLAN ID 把用户划分为更小的工作组，限制不同工作组间的用户互访，每个工作组就是一个虚拟局域网。虚拟局域网的好处是可以限制广播范围，并能够形成虚拟工作组，动态管理网络。 VLAN 是一种比较新的技术，工作在 OSI 参考模型的第2层和第3层，一个 VLAN 就是一个广播域， VLAN 之间的通信是通过第3层的路由器来完成的。
