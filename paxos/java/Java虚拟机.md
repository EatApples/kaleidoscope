### `Java`虚拟机
本文是学习《极客时间》`郑雨迪`主讲的 `《深入拆解Java虚拟机》` 的个人总结。

### 1. 基本原理
#### 1.1 操作码
`Java`字节码指令的操作码（`opcode`）被固定为一个字节。

#### 1.2 方法区
加载后的`Java`类会被存放于方法区（`Method Area`）。实际运行时，虚拟机会执行方法区内的代码。

#### 1.3 基本类型
`Java`基本类型（8种）：`boolean`，`byte`，`short`，`char`，`int`，`long`，`float`，`double`。其中`boolean`和`char`是无符号类型。

#### 1.4 正无穷和负无穷
在`Java`中，浮点数的正无穷和负无穷有确切数值，在内存中分别为十六进制`0x7F800000`（正无穷），`0xFF800000`（负无穷）。

#### 1.5 `NaN`
`NaN`（`Not-a-Number`）除了`!=`始终返回`true`外，所有其他比较结果都会返回`false`。

#### 1.6 引用类型
`Java`引用类型细分为4种：`类`，`接口`，`数组类`，`泛型参数`。泛型参数在编译过程中被擦除，数组类由`Java`虚拟机直接生成，类和接口有对应的字节流。

#### 1.7 加载
加载：在`Java`虚拟机中，类的唯一性由类加载器实例以及类的全名一同确定。加载是指查找字节流，并且据此创建类的过程。

#### 1.8 链接
链接：分为`验证`（确保加载的类满足`Java`虚拟机的约束条件），`准备`（为被加载类的静态字段分配内存）以及`解析`（解析阶段的目的，正是将`符号引用`解析成`实际引用`。如果符号引用指向未被加载的类，或未被加载类的字段或方法，那么解析将触发这个类的加载，但未必触发这个类的链接及初始化）三阶段。`Java`虚拟机规范并没有要求在链接过程中完成解析：如果某些字节码使用了符号引用，那么在执行这些字节码之前，需要完成对这些符号引用的解析。

#### 1.9 初始化
初始化：只有初始化完成之后，类才正式成为可执行的状态。

#### 1.10 重载
重载的方法在编译过程中即可完成识别，因此可以认为`Java`虚拟机中不存在重载。`Java`编译器会根据所传入参数的声明类型（注意与实际类型区分）来选取重载方法。考虑是否允许基本类型自动装拆箱与可变长参数，这个过程分为有序的三个阶段，如果前面阶段没有适配，再考虑下一阶段：00（都不允许），10（允许装拆箱但不允许可变长），11（全都允许）。如果在同一阶段找到多个适配的方法，则会选择一个最为贴切的（关键就是形参类型的继承关系）。

#### 1.11 重写
方法重写：多态的重要的一种体现方式。它允许子类在继承父类部分功能的同时，拥有自己独特的行为。重写调用会根据调用者的动态类型，来选取实际的目标方法。

#### 1.12 识别方法
`Java`虚拟机识别方法的关键在于类名、方法名以及方法描述符（`method descriptor`）（由方法的参数类型以及返回类型所构成）。注意`Java`虚拟机与`Java`语言语言不同，它并不限制名字与参数类型相同，但返回类型不同的方法出现在同一个类中。对于调用这些方法的字节码来说，由于字节码附带的方法描述符包含了返回类型，因此`Java`虚拟机能够准确地识别目标方法。

#### 1.13 方法重写判定
`Java`虚拟机关于方法重写的判定基于方法的描述符。如果子类定义了与父类中非私有、非静态同名方法的方法，那么只有当这两个方法的参数类型以及返回类型一致，`Java`虚拟机才会判定为重写。

#### 1.14 桥接方法
对于`Java`语言中重写而`Java`虚拟机中非重写的情况，编译器会通过生成桥接方法来实现`Java`中的重写定义。

#### 1.15 静态绑定与动态绑定
`Java`虚拟机中的静态绑定指的是在解析时能够直接识别目标方法的情况；而动态绑定则指的是需要在运行过程中根据调用者的动态类型来识别目标方法的情况。

#### 1.16 符号引用
在编译过程中，我们并不知道目标方法的具体内存地址。`Java`编译器会暂时用符号引用来表示该目标方法（包括目标方法所在的类或接口的名字，以及目标方法的方法名和方法描述符）

#### 1.17 静态方法
静态方法可以通过子类来调用。子类的静态方法会隐藏（不是重写）父类中的同名、同描述符的静态方法。

#### 1.18 实际引用
对于静态绑定的方法调用而言，实际引用是一个指向方法的指针。对于动态绑定的方法调用而言，实际引用则是一个方法表的索引。

### 2. 高效实现

### 3. 代码优化

### 4. 虚拟机黑科技
