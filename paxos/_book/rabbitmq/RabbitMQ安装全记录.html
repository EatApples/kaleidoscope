
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>4.3 RabbitMQ安装全记录 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="RabbitMQ多地址连接.html" />
    
    
    <link rel="prev" href="RabbitMQ四种发送方式区别.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    0 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../">
            
                <a href="../">
            
                    
                    1 Algorithm
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../algorithm/CAP.html">
            
                <a href="../algorithm/CAP.html">
            
                    
                    1.1 CAP理论
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../algorithm/ZAB协议.html">
            
                <a href="../algorithm/ZAB协议.html">
            
                    
                    1.2 ZAB协议
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../algorithm/分布式锁.html">
            
                <a href="../algorithm/分布式锁.html">
            
                    
                    1.3 分布式锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../algorithm/raft-zh_cn.html">
            
                <a href="../algorithm/raft-zh_cn.html">
            
                    
                    1.4 RAFT算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../algorithm/PAXOS.html">
            
                <a href="../algorithm/PAXOS.html">
            
                    
                    1.5 3分钟理解PAXOS算法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../">
            
                <a href="../">
            
                    
                    2 Java
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../java/从实际案例聊聊Java应用的GC优化.html">
            
                <a href="../java/从实际案例聊聊Java应用的GC优化.html">
            
                    
                    2.1 JavaGC优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../java/设计模式23.html">
            
                <a href="../java/设计模式23.html">
            
                    
                    2.2 设计模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../java/Effective Java.html">
            
                <a href="../java/Effective Java.html">
            
                    
                    2.3 EffectiveJava
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../java/Java学习笔记.html">
            
                <a href="../java/Java学习笔记.html">
            
                    
                    2.4 Java学习笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../java/JDK相关.html">
            
                <a href="../java/JDK相关.html">
            
                    
                    2.5 JDK相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../java/AlibabaJavaCodingGuidelines.html">
            
                <a href="../java/AlibabaJavaCodingGuidelines.html">
            
                    
                    2.6 阿里Java编码规范整理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../java/Java程序执行次序.html">
            
                <a href="../java/Java程序执行次序.html">
            
                    
                    2.7 深入了解Java程序执行顺序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../java/JDK定时任务对比.html">
            
                <a href="../java/JDK定时任务对比.html">
            
                    
                    2.8 JDK定时任务对比
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../">
            
                <a href="../">
            
                    
                    3 SpringBoot
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../springboot/SpringBoot-pom-xml.html">
            
                <a href="../springboot/SpringBoot-pom-xml.html">
            
                    
                    3.1 SpringBoot的pom.xml
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../springboot/SpringBoot注解.html">
            
                <a href="../springboot/SpringBoot注解.html">
            
                    
                    3.2 SpringBoot的注解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../springboot/Eureka.html">
            
                <a href="../springboot/Eureka.html">
            
                    
                    3.3 Eureka
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../springboot/LogBack相关.html">
            
                <a href="../springboot/LogBack相关.html">
            
                    
                    3.4 LogBack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../springboot/Maven相关.html">
            
                <a href="../springboot/Maven相关.html">
            
                    
                    3.5 Maven
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../springboot/OAuth2.0.html">
            
                <a href="../springboot/OAuth2.0.html">
            
                    
                    3.6 OAuth2.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../springboot/SpringBoot排错.html">
            
                <a href="../springboot/SpringBoot排错.html">
            
                    
                    3.7 SpringBoot排错
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../springboot/SpringBoot排雷现场.html">
            
                <a href="../springboot/SpringBoot排雷现场.html">
            
                    
                    3.8 SpringBoot排雷现场
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../springboot/SpringBoot释疑.html">
            
                <a href="../springboot/SpringBoot释疑.html">
            
                    
                    3.9 SpringBoot释疑
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../springboot/SpringBoot引入log4j的配置.html">
            
                <a href="../springboot/SpringBoot引入log4j的配置.html">
            
                    
                    3.10 SpringBoot引入log4j的配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../springboot/SpringBoot启动脚本.html">
            
                <a href="../springboot/SpringBoot启动脚本.html">
            
                    
                    3.11 SpringBoot启动脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../springboot/SpringBoot定时任务.html">
            
                <a href="../springboot/SpringBoot定时任务.html">
            
                    
                    3.12 SpringBoot定时任务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../springboot/SpringBoot初始化任务.html">
            
                <a href="../springboot/SpringBoot初始化任务.html">
            
                    
                    3.13 SpringBoot初始化任务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../springboot/SpringBootRedis.html">
            
                <a href="../springboot/SpringBootRedis.html">
            
                    
                    3.14 SpringBootRedis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.15" data-path="../springboot/SpringBootRabbitMQ.html">
            
                <a href="../springboot/SpringBootRabbitMQ.html">
            
                    
                    3.15 SpringBootRabbitMQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.16" data-path="../springboot/packaging为pom标签的用法.html">
            
                <a href="../springboot/packaging为pom标签的用法.html">
            
                    
                    3.16 pom标签
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.17" data-path="../springboot/客户端配置更新.html">
            
                <a href="../springboot/客户端配置更新.html">
            
                    
                    3.17 客户端配置更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.18" data-path="../springboot/SpringBoot配置优先级.html">
            
                <a href="../springboot/SpringBoot配置优先级.html">
            
                    
                    3.18 SpringBoot配置优先级
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../">
            
                <a href="../">
            
                    
                    4 RabbitMQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="RabbitMQ相关.html">
            
                <a href="RabbitMQ相关.html">
            
                    
                    4.1 RabbitMQ相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="RabbitMQ四种发送方式区别.html">
            
                <a href="RabbitMQ四种发送方式区别.html">
            
                    
                    4.2 RabbitMQ四种发送方式区别
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.3" data-path="RabbitMQ安装全记录.html">
            
                <a href="RabbitMQ安装全记录.html">
            
                    
                    4.3 RabbitMQ安装全记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="RabbitMQ多地址连接.html">
            
                <a href="RabbitMQ多地址连接.html">
            
                    
                    4.4 RabbitMQ多地址连接
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../">
            
                <a href="../">
            
                    
                    5 Shell
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../shell/免密登陆.html">
            
                <a href="../shell/免密登陆.html">
            
                    
                    5.1 免密登陆
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../shell/iptables命令.html">
            
                <a href="../shell/iptables命令.html">
            
                    
                    5.2 iptables命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../shell/scp命令.html">
            
                <a href="../shell/scp命令.html">
            
                    
                    5.3 scp命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../shell/shell特殊变量的含义.html">
            
                <a href="../shell/shell特殊变量的含义.html">
            
                    
                    5.4 shell特殊变量的含义
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../shell/TCP最大连接数.html">
            
                <a href="../shell/TCP最大连接数.html">
            
                    
                    5.5 TCP最大连接数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../">
            
                <a href="../">
            
                    
                    6 ZooKeeper
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../zookeeper/ZooKeeper集群安装.html">
            
                <a href="../zookeeper/ZooKeeper集群安装.html">
            
                    
                    6.1 ZooKeeper集群安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../zookeeper/ZooKeeper权限控制.html">
            
                <a href="../zookeeper/ZooKeeper权限控制.html">
            
                    
                    6.2 ZooKeeper权限控制
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../zookeeper/ZooKeeperWatcher.html">
            
                <a href="../zookeeper/ZooKeeperWatcher.html">
            
                    
                    6.3 ZooKeeperWatcher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../zookeeper/ZooKeeper连接.html">
            
                <a href="../zookeeper/ZooKeeper连接.html">
            
                    
                    6.4 ZooKeeper连接
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../pic/PIC.html">
            
                <a href="../pic/PIC.html">
            
                    
                    7 Pic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../">
            
                <a href="../">
            
                    
                    8 Other
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../other/GitBook.html">
            
                <a href="../other/GitBook.html">
            
                    
                    1 GitBook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../other/MySQL.html">
            
                <a href="../other/MySQL.html">
            
                    
                    2 MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../other/MD语法.html">
            
                <a href="../other/MD语法.html">
            
                    
                    3 MarkDown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../other/windows相关.html">
            
                <a href="../other/windows相关.html">
            
                    
                    4 Windows相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../other/Sublime Text 3 快捷键精华版.html">
            
                <a href="../other/Sublime Text 3 快捷键精华版.html">
            
                    
                    5 SublimeText3快捷键精华版
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../other/zabbix.html">
            
                <a href="../other/zabbix.html">
            
                    
                    6 Zabbix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../other/Nginx安装.html">
            
                <a href="../other/Nginx安装.html">
            
                    
                    7 Nginx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../other/TBSchedule.html">
            
                <a href="../other/TBSchedule.html">
            
                    
                    8 TBSchedule
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../other/webdis安装.html">
            
                <a href="../other/webdis安装.html">
            
                    
                    9 webdis安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >4.3 RabbitMQ安装全记录</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h3 id="1-jdk-&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8BBE;&#x7F6E;">1 JDK &#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8BBE;&#x7F6E;</h3>
<pre><code class="lang-shell">&#x7F16;&#x8F91;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF1A;

# vi /etc/profile

&#x8FFD;&#x52A0;&#x5185;&#x5BB9;&#xFF1A;

export JAVA_HOME=/opt/jdk1.8.0_131
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar

&#x4F7F;&#x914D;&#x7F6E;&#x751F;&#x6548;&#xFF1A;

# source /etc/profile
</code></pre>
<h3 id="2-erlang-&#x5B89;&#x88C5;&#x6B65;&#x9AA4;">2 Erlang &#x5B89;&#x88C5;&#x6B65;&#x9AA4;</h3>
<pre><code class="lang-shell">1. &#x89E3;&#x538B;&#x6E90;&#x7801;

# tar -xvf otp_src_20.0.tar.gz

2. &#x8FDB;&#x5165;&#x76EE;&#x5F55;

# cd otp_src_20.0

3. &#x8BBE;&#x7F6E;&#x73AF;&#x5883;

# export ERL_TOP=`pwd`    # Assuming bash/sh

4. &#x6821;&#x9A8C;&#x4F9D;&#x8D56;

# ./configure --prefix=/opt/erlang/20.0 --without-javac

5. &#x7F3A;&#x5C11;&#x4F9D;&#x8D56;

# yum list | grep XX    

6. &#x5B89;&#x88C5;&#x4F9D;&#x8D56;    

#&#x3000;yum install XX

#&#x3000;yum install ncurses-devel unixODBC unixODBC-devel

7. &#x6307;&#x5B9A;&#x7F16;&#x8BD1;

# export LANG=C   # Assuming bash/sh

8. &#x7F16;&#x8BD1;

# make

# make install

9. &#x5EFA;&#x7ACB;&#x8F6F;&#x8FDE;&#x63A5;

# ln -s /app/otp_src_20.0/bin/erl /usr/bin/erl
</code></pre>
<h3 id="3-&#x642D;&#x5EFA;-rabbitmq-&#x96C6;&#x7FA4;">3 &#x642D;&#x5EFA; RabbitMQ &#x96C6;&#x7FA4;</h3>
<pre><code>&#x8FD9;&#x91CC;&#x642D;&#x5EFA;3&#x53F0;&#x673A;&#x5668;&#x7684;RabbitMQ&#x96C6;&#x7FA4;&#x3002;

0. &#x547D;&#x540D;&#x6BCF;&#x4E2A;&#x96C6;&#x7FA4;&#x673A;&#x5668;&#x7684;hostname

&#x673A;&#x5668;1&#xFF1A;# hostname HOST1
&#x673A;&#x5668;2&#xFF1A;# hostname HOST2
&#x673A;&#x5668;3&#xFF1A;# hostname HOST3

1. &#x4FEE;&#x6539;&#x6240;&#x6709;&#x96C6;&#x7FA4;&#x673A;&#x5668;&#x7684; /etc/hosts
&#x8FFD;&#x52A0;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#xFF1A;

IP1  HOST1
IP2  HOST2
IP3  HOST3

2. &#x4FDD;&#x6301;erlang.cookie&#x4E00;&#x81F4;
&#x5148;&#x542F;&#x52A8;&#x4E00;&#x53F0;&#x673A;&#x5668;&#x7684; RabbitMQ &#x670D;&#x52A1;&#xFF0C;Erlang &#x4F1A;&#x751F;&#x6210; cookie &#x6587;&#x4EF6;&#xFF1A;.erlang.cookie &#xFF1B;
&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E00;&#x822C;&#x5728; home &#x8DEF;&#x5F84;&#xFF1B;
&#x5C06; .erlang.cookie &#x590D;&#x5236;&#x5230;&#x5176;&#x4ED6;&#x96C6;&#x7FA4;&#x673A;&#x5668;&#x7684;&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;&#xFF0C;&#x5E76;&#x4FEE;&#x6539;&#x6743;&#x9650;&#xFF1A;

# chmod 600 ~/.erlang.cookie

3. &#x6267;&#x884C;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#xFF0C;&#x52A0;&#x5165; RabbitMQ &#x96C6;&#x7FA4;

3.0 &#x5F00;&#x542F;&#x63A7;&#x5236;&#x53F0;

# ./rabbitmq-plugins enable rabbitmq_management

3.1 &#x542F;&#x52A8;&#x670D;&#x52A1;

# nohup ./rabbitmq-server start &gt; rabbitmq.log &amp;

3.2 &#x505C;&#x6B62;&#x670D;&#x52A1;&#x5E94;&#x7528;

# ./rabbitmqctl stop_app

3.3 &#x52A0;&#x5165;&#x96C6;&#x7FA4;

# ./rabbitmqctl join_cluster rabbit@HOST1

3.4 &#x542F;&#x52A8;&#x670D;&#x52A1;&#x5E94;&#x7528;

# ./rabbitmqctl start_app

3.5 &#x67E5;&#x770B;&#x96C6;&#x7FA4;&#x72B6;&#x6001;

# ./rabbitmqctl cluster_status

4. &#x6DFB;&#x52A0;&#x7528;&#x6237;

# ./rabbitmqctl add_user USER PASSWORD

# ./rabbitmqctl set_user_tags USER administrator

# ./rabbitmqctl set_permissions -p / USER &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
</code></pre><h3 id="4-rabbitmq-&#x542F;&#x505C;&#x547D;&#x4EE4;">4 RabbitMQ &#x542F;&#x505C;&#x547D;&#x4EE4;</h3>
<pre><code>&#x96F6;&#xFF0C;&#x5F00;&#x542F;&#x63A7;&#x5236;&#x53F0;

# ./rabbitmq-plugins enable rabbitmq_management

&#x4E00;&#xFF0C;&#x542F;&#x52A8;&#x670D;&#x52A1;

# nohup ./rabbitmq-server start &gt; rabbitmq.log &amp;

&#x4E8C;&#xFF0C;&#x505C;&#x6B62;&#x670D;&#x52A1;&#x5E94;&#x7528;

# ./rabbitmqctl stop_app

&#x4E09;&#xFF0C;&#x542F;&#x52A8;&#x670D;&#x52A1;&#x5E94;&#x7528;

# ./rabbitmqctl start_app

&#x56DB;&#xFF0C;&#x505C;&#x6B62;&#x5E94;&#x7528;

# ./rabbitmqctl stop
</code></pre><h3 id="5-&#x4F7F;&#x7528;-guest-&#x767B;&#x5F55;">5 &#x4F7F;&#x7528; guest &#x767B;&#x5F55;</h3>
<pre><code>Rabbitmq &#x9ED8;&#x8BA4;&#x5141;&#x8BB8; guest &#x672C;&#x5730;&#x8BBF;&#x95EE;&#x3002;&#x4E3A;&#x4E86;&#x65B9;&#x4FBF;&#x9700;&#x8981;&#x5141;&#x8BB8;&#x8FDC;&#x7A0B;&#x8BBF;&#x95EE;&#x3002;

&#x628A; rabbitmq.config.example &#x590D;&#x5236;&#x4E00;&#x4EFD;&#x5230; /etc/rabbitmq/rabbitmq.config&#xFF0C;&#x5728; rabbit &#x6BB5;&#x4E2D;&#xFF0C;&#x6309;&#x5982;&#x4E0B;&#x683C;&#x5F0F;

[{rabbit, [{loopback_users, []}]}]

&#xFF08;1&#xFF09;&#x627E;&#x5230; rabbitmq.config &#x6587;&#x4EF6;&#xFF08;find / -name rabbitmq.config &#xFF09;
&#xFF08;2&#xFF09;&#x6253;&#x5F00; rabbitmq.config &#x6587;&#x4EF6;&#xFF0C;&#x53BB;&#x6389;&#x8FD9;&#x4E00;&#x884C;&#x6CE8;&#x91CA;&#x5373;&#x53EF;&#xFF08;{loopback_users, []},&#xFF09;
&#xFF08;3&#xFF09;rabbitmq-server start &#x91CD;&#x542F;&#xFF0C;OK
&#xFF08;4&#xFF09;&#x5F00;&#x542F;&#x63A7;&#x5236;&#x53F0;

 # ./rabbitmq-plugins enable rabbitmq_management
</code></pre><h3 id="6-rabbitmqctl-&#x547D;&#x4EE4;&#x4F7F;&#x7528;">6 rabbitmqctl &#x547D;&#x4EE4;&#x4F7F;&#x7528;</h3>
<pre><code>rabbitmqctl list_queues&#xFF1A;&#x67E5;&#x770B;&#x6240;&#x6709;&#x961F;&#x5217;&#x4FE1;&#x606F;

rabbitmqctl stop_app&#xFF1A;&#x5173;&#x95ED;&#x5E94;&#x7528;&#xFF08;&#x5173;&#x95ED;&#x5F53;&#x524D;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#xFF09;

rabbitmqctl start_app&#xFF1A;&#x542F;&#x52A8;&#x5E94;&#x7528;&#xFF0C;&#x548C;&#x4E0A;&#x8FF0;&#x5173;&#x95ED;&#x547D;&#x4EE4;&#x914D;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x8FBE;&#x5230;&#x6E05;&#x7A7A;&#x961F;&#x5217;&#x7684;&#x76EE;&#x7684;

rabbitmqctl reset&#xFF1A;&#x4ECE;&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x79FB;&#x9664;&#x6240;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x4F8B;&#x5982;&#x914D;&#x7F6E;&#x8FC7;&#x7684;&#x7528;&#x6237;&#x548C;&#x865A;&#x62DF;&#x5BBF;&#x4E3B;, &#x5220;&#x9664;&#x6240;&#x6709;&#x6301;&#x4E45;&#x5316;&#x7684;&#x6D88;&#x606F;&#xFF08;&#x8FD9;&#x4E2A;&#x547D;&#x4EE4;&#x8981;&#x5728;rabbitmqctl stop_app&#x4E4B;&#x540E;&#x4F7F;&#x7528;&#xFF09;

rabbitmqctl force_reset&#xFF1A;&#x4F5C;&#x7528;&#x548C;rabbitmqctl reset&#x4E00;&#x6837;&#xFF0C;&#x533A;&#x522B;&#x662F;&#x65E0;&#x6761;&#x4EF6;&#x91CD;&#x7F6E;&#x8282;&#x70B9;&#xFF0C;&#x4E0D;&#x7BA1;&#x5F53;&#x524D;&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x96C6;&#x7FA4;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x5982;&#x679C;&#x6570;&#x636E;&#x5E93;&#x6216;&#x8005;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x624D;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x6700;&#x540E;&#x7684;&#x624B;&#x6BB5;

rabbitmqctl status&#xFF1A;&#x8282;&#x70B9;&#x72B6;&#x6001;

rabbitmqctl add_user username password&#xFF1A;&#x6DFB;&#x52A0;&#x7528;&#x6237;

rabbitmqctl list_users&#xFF1A;&#x5217;&#x51FA;&#x6240;&#x6709;&#x7528;&#x6237;

rabbitmqctl list_user_permissions username&#xFF1A;&#x5217;&#x51FA;&#x7528;&#x6237;&#x6743;&#x9650;

rabbitmqctl change_password username newpassword&#xFF1A;&#x4FEE;&#x6539;&#x5BC6;&#x7801;

rabbitmqctl add_vhost vhostpath&#xFF1A;&#x521B;&#x5EFA;&#x865A;&#x62DF;&#x4E3B;&#x673A;

rabbitmqctl list_vhosts&#xFF1A;&#x5217;&#x51FA;&#x6240;&#x6709;&#x865A;&#x62DF;&#x4E3B;&#x673A;

rabbitmqctl set_permissions -p vhostpath username &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;&#xFF1A;&#x8BBE;&#x7F6E;&#x7528;&#x6237;&#x6743;&#x9650;

rabbitmqctl list_permissions -p vhostpath&#xFF1A;&#x5217;&#x51FA;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#x4E0A;&#x7684;&#x6240;&#x6709;&#x6743;&#x9650;

rabbitmqctl clear_permissions -p vhostpath username&#xFF1A;&#x6E05;&#x9664;&#x7528;&#x6237;&#x6743;&#x9650;

rabbitmqctl -p vhostpath purge_queue &#xFF1A;&#x6E05;&#x9664;&#x961F;&#x5217;&#x91CC;&#x7684;&#x6D88;&#x606F;

rabbitmqctl delete_user username&#xFF1A;&#x5220;&#x9664;&#x7528;&#x6237;

rabbitmqctl delete_vhost vhostpath&#xFF1A;&#x5220;&#x9664;&#x865A;&#x62DF;&#x4E3B;&#x673A;
</code></pre><h3 id="7-&#x955C;&#x50CF;&#x6A21;&#x5F0F;&#x914D;&#x7F6E;">7 &#x955C;&#x50CF;&#x6A21;&#x5F0F;&#x914D;&#x7F6E;</h3>
<pre><code>Policy: all-mirrors
Overview
Virtual Host    /
Pattern .*
Apply to    all
Definition
ha-mode:    all
ha-sync-mode:   automatic
Priority    0
</code></pre><h3 id="8-&#x53EA;&#x8BFB;&#x7528;&#x6237;&#x914D;&#x7F6E;">8 &#x53EA;&#x8BFB;&#x7528;&#x6237;&#x914D;&#x7F6E;</h3>
<pre><code>0. &#x5EFA;&#x7ACB;&#x7528;&#x6237;&#xFF0C;&#x7ED9;&#x7684;&#x6807;&#x7B7E;&#x662F;&#xFF1A;
[Management]

1. &#x8D4B;&#x6743;&#x90E8;&#x5206;&#x5168;&#x90E8;&#x7F6E;&#x4E3A;&#x7A7A;&#xFF1A;

Set permission
Virtual Host:/
Configure regexp:
Write regexp:
Read regexp:

2. &#x6548;&#x679C;&#x5982;&#x4E0B;&#xFF1A;
Current permissions
Virtual host    Configure regexp    Write regexp    Read regexp
/

&#x8BE5;&#x7528;&#x6237;&#x5C31;&#x662F;&#x53EA;&#x8BFB;&#x7528;&#x6237;&#x4E86;&#x3002;
</code></pre><h3 id="9-&#x5254;&#x9664;-rabbitmq-&#x96C6;&#x7FA4;&#x4E2D;&#x65E0;&#x6548;&#x7684;&#x8282;&#x70B9;">9 &#x5254;&#x9664; RabbitMQ &#x96C6;&#x7FA4;&#x4E2D;&#x65E0;&#x6548;&#x7684;&#x8282;&#x70B9;</h3>
<pre><code>
# ./rabbitmqctl forget_cluster_node NODENAME

&#x5BF9;&#x4E8E;&#x72B6;&#x6001;&#x5F02;&#x5E38;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x5148;&#x5220;&#x9664;

/var/lib/rabbitmq/mnesia

&#x6587;&#x4EF6;&#xFF0C;&#x518D;&#x505A;&#x64CD;&#x4F5C;
</code></pre><h3 id="10-&#x96C6;&#x7FA4;&#x5B98;&#x65B9;&#x6587;&#x6863;">10 &#x96C6;&#x7FA4;&#x5B98;&#x65B9;&#x6587;&#x6863;</h3>
<p><a href="https://www.rabbitmq.com/clustering.html" target="_blank">https://www.rabbitmq.com/clustering.html</a></p>
<h3 id="clustering-guide">Clustering Guide</h3>
<h4 id="overview">Overview</h4>
<p>A RabbitMQ broker is a logical grouping of one or several Erlang nodes, each running the RabbitMQ application and sharing users, virtual hosts, queues, exchanges, bindings, and runtime parameters. Sometimes we refer to the collection of nodes as a cluster.</p>
<h4 id="what-is-replicated">What is Replicated?</h4>
<p>All data/state required for the operation of a RabbitMQ broker is replicated across all nodes. An exception to this are message queues, which by default reside on one node, though they are visible and reachable from all nodes. To replicate queues across nodes in a cluster, see the documentation on high availability (note that you will need a working cluster first).</p>
<h4 id="hostname-resolution-requirements">Hostname Resolution Requirements</h4>
<p>RabbitMQ nodes address each other using domain names, either short or fully-qualified (FQDNs). Therefore hostnames of all cluster members must be resolvable from all cluster nodes, as well as machines on which command line tools such as rabbitmqctl might be used.</p>
<p>Hostname resolution can use any of the standard OS-provided methods:</p>
<p>DNS records</p>
<p>Local host files (e.g. /etc/hosts)</p>
<p>In more restrictive environments, where DNS record or hosts file modification is restricted, impossible or undesired, Erlang VM can be configured to use alternative hostname resolution methods, such as an alternative DNS server, a local file, a non-standard hosts file location, or a mix of methods. Those methods can work in concert with the standard OS hostname resolution methods.
To use FQDNs, see RABBITMQ_USE_LONGNAME in the Configuration guide.</p>
<p><strong><em>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x672C;&#x5730;HOSTS&#x6765;&#x5EFA;&#x7ACB;&#x96C6;&#x7FA4;&#x3002;</em></strong></p>
<h4 id="cluster-formation">Cluster Formation</h4>
<p>A RabbitMQ cluster can formed in a number of ways:</p>
<ul>
<li>Declaratively by listing cluster nodes in config file</li>
<li>Declaratively using DNS-based discovery</li>
<li>Declaratively using AWS (EC2) instance discovery (via a plugin)</li>
<li>Declaratively using Kubernetes discovery (via a plugin)</li>
<li>Declaratively using Consul-based discovery (via a plugin)</li>
<li>Declaratively using etcd-based discovery (via a plugin)</li>
<li>Manually with rabbitmqctl</li>
</ul>
<p>Please refer to the Cluster Formation guide for details.</p>
<p>The composition of a cluster can be altered dynamically. All RabbitMQ brokers start out as running on a single node. These nodes can be joined into clusters, and subsequently turned back into individual brokers again.</p>
<p><strong><em>&#x96C6;&#x7FA4;&#x53EF;&#x52A8;&#x6001;&#x6269;&#x5C55;&#xFF0C;RabbitMQ&#x8282;&#x70B9;&#x53EF;&#x81EA;&#x7531;&#x7684;&#x52A0;&#x5165;/&#x79BB;&#x5F00;&#x96C6;&#x7FA4;&#x3002;</em></strong></p>
<h4 id="failure-handling">Failure Handling</h4>
<p>RabbitMQ brokers tolerate the failure of individual nodes. Nodes can be started and stopped at will, as long as they can contact a cluster member node known at the time of shutdown.</p>
<p>RabbitMQ clustering has several modes of dealing with network partitions, primarily consistency oriented. Clustering is meant to be used across LAN. It is not recommended to run clusters that span WAN. The Shovel or Federation plugins are better solutions for connecting brokers across a WAN. Note that Shovel and Federation are not equivalent to clustering.</p>
<p><strong><em>RabbitMQ&#x96C6;&#x7FA4;&#x5177;&#x6709;&#x5206;&#x533A;&#x5BB9;&#x9519;&#x6027;&#xFF08;CAP&#x7684;P&#xFF09;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x6709;&#x7EBF;&#x800C;&#x4E0D;&#x662F;&#x65E0;&#x7EBF;&#x6765;&#x8FDB;&#x884C;&#x96C6;&#x7FA4;&#x901A;&#x8BAF;&#x3002;</em></strong></p>
<h4 id="disk-and-ram-nodes">Disk and RAM Nodes</h4>
<p>A node can be a disk node or a RAM node. (Note: disk and disc are used interchangeably). RAM nodes store internal database tables in RAM. This does not include messages, message store indices, queue indices and other node state.</p>
<p>In well over 90% of cases you want all your nodes to be disk nodes; RAM nodes are a special case that can be used to improve the performance clusters with high queue, exchange, or binding churn. RAM nodes do not provide meaningfully higher message rates. When in doubt, use disk nodes only.</p>
<p>Since RAM nodes store internal database tables in RAM only, they must sync them from a peer node on startup. This means that a cluster must contain at least one disk node. It is therefore not possible to manually remove the last remaining disk node in a cluster.</p>
<p><strong><em>RAM&#x6A21;&#x5F0F;&#x53EA;&#x4FDD;&#x5B58;&#x5185;&#x90E8;&#x6570;&#x636E;&#x5E93;&#x8868;&#xFF0C;&#x4E0D;&#x5B58;&#x6D88;&#x606F;&#xFF0C;&#x7D22;&#x5F15;&#x7B49;&#x4FE1;&#x606F;&#x3002;&#x5982;&#x679C;&#x6709;&#x7591;&#x8651;&#xFF0C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x78C1;&#x76D8;&#x6A21;&#x5F0F;&#x3002;&#x96C6;&#x7FA4;&#x4E2D;&#x4E00;&#x5B9A;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x78C1;&#x76D8;&#x8282;&#x70B9;&#xFF08;&#x4E00;&#x5B9A;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x5DEB;&#x5996;&#x738B;&#xFF09;&#x3002;</em></strong></p>
<h4 id="clustering-transcript-with-rabbitmqctl">Clustering Transcript with rabbitmqctl</h4>
<p>The following is a transcript of setting up and manipulating a RabbitMQ cluster across three machines - rabbit1, rabbit2, rabbit3.</p>
<p><strong><em>&#x8FD9;&#x91CC;&#x5C06;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;3&#x8282;&#x70B9;&#x96C6;&#x7FA4;&#xFF1A; rabbit1, rabbit2, rabbit3</em></strong></p>
<p>We assume that the user is logged into all three machines, that RabbitMQ has been installed on the machines, and that the rabbitmq-server and rabbitmqctl scripts are in the user&apos;s PATH.</p>
<p>This transcript can be modified to run on a single host, as explained more details below.</p>
<h4 id="how-nodes-and-cli-tools-authenticate-to-each-other-the-erlang-cookie">How Nodes (and CLI tools) Authenticate to Each Other: the Erlang Cookie</h4>
<p>RabbitMQ nodes and CLI tools (e.g. rabbitmqctl) use a cookie to determine whether they are allowed to communicate with each other. For two nodes to be able to communicate they must have the same shared secret called the Erlang cookie. The cookie is just a string of alphanumeric characters up to 255 characters in size. It is usually stored in a local file. The file must be only accessible to the owner (e.g. have UNIX permissions of 600 or similar). Every cluster node must have the same cookie.</p>
<p><strong><em>.erlang.cookie &#x4E2D;&#x5B58;&#x50A8;&#x8BC6;&#x522B;&#x5B57;&#x7B26;&#xFF0C;&#x6700;&#x591A;255&#x4E2A;&#x3002;&#x5728;linux&#x4E2D;&#x9700; chmod 600 .erlang.cookie</em></strong></p>
<p>If the file does not exist, Erlang VM will automatically create one with a randomly generated value when the RabbitMQ server starts up. Erlang cookie management is best done using automation tools such as Chef, BOSH, Docker or similar.</p>
<p>On UNIX systems, the cookie will be typically located in /var/lib/rabbitmq/.erlang.cookie (used by the server) and $HOME/.erlang.cookie (used by CLI tools). Note that since the value of <code>$HOME</code> varies from user to user, it&apos;s necessary to place a copy of the cookie file for each user that will be using the CLI tools. This applies to both non-privileged users and <code>root</code>.</p>
<p><strong><em>.erlang.cookie &#x4E00;&#x822C;&#x5728; HOME &#x8DEF;&#x5F84;&#x3002;</em></strong></p>
<p>On Windows, the cookie file location varies depending on Erlang version used and whether the HOMEDRIVE or HOMEPATH environment variables are set.</p>
<p>When the cookie is misconfigured (for example, not identical), RabbitMQ will log errors such as <strong>&quot;Connection attempt from disallowed node&quot; and &quot;Could not auto-cluster&quot;.</strong> When a CLI tool such as rabbitmqctl fails to authenticate with RabbitMQ, the message usually says</p>
<p><strong><em>&#x8981;&#x662F; .erlang.cookie &#x4E0D;&#x7B26;&#xFF0C;&#x53EF;&#x80FD;&#x62A5;&#x4EE5;&#x4E0B;&#x9519;&#x8BEF;&#xFF1A;</em></strong></p>
<pre><code>* epmd reports node &apos;rabbit&apos; running on port 25672
* TCP connection succeeded but Erlang distribution failed
* suggestion: hostname mismatch?
* suggestion: is the cookie set correctly?
* suggestion: is the Erlang distribution using TLS?
</code></pre><p>An incorrectly placed cookie file or cookie value mismatch are most common scenarios for such failures. When a recent Erlang/OTP version is used, authentication failures contain more information and cookie mismatches can be identified better:</p>
<pre><code>* connected to epmd (port 4369) on warp10
* epmd reports node &apos;rabbit&apos; running on port 25672
* TCP connection succeeded but Erlang distribution failed

* Authentication failed (rejected by the remote node), please check the Erlang cookie
</code></pre><p><strong><em>&#x96C6;&#x7FA4;&#x4E2D;&#x8282;&#x70B9;&#x9760; .erlang.cookie &#x6765;&#x8BC6;&#x522B;&#x81EA;&#x5DF1;&#x4EBA;&#x3002;&#x82E5;&#x662F;&#x53E3;&#x53F7;&#x4E0D;&#x5BF9;&#xFF0C;&#x5C31;&#x62A5;&#x9519;&#x7ED9;&#x4F60;&#x770B;&#x3002;</em></strong></p>
<h4 id="starting-independent-nodes">Starting independent nodes</h4>
<p>&#x89C1;&#x524D;&#x6587;</p>
<h4 id="creating-the-cluster">Creating the cluster</h4>
<p>&#x89C1;&#x524D;&#x6587;</p>
<h4 id="restarting-cluster-nodes">Restarting cluster nodes</h4>
<p>Nodes that have been joined to a cluster can be stopped at any time. It is also ok for them to crash. In both cases the rest of the cluster continues operating, and the nodes automatically &quot;catch up&quot; with (sync from) the other cluster nodes when they start up again.</p>
<p>We shut down the nodes rabbit@rabbit1 and rabbit@rabbit3 and check on the cluster status at each step:</p>
<pre><code>rabbit1$ rabbitmqctl stop
Stopping and halting node rabbit@rabbit1 ...done.
rabbit2$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit2 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},
 {running_nodes,[rabbit@rabbit3,rabbit@rabbit2]}]
...done.
rabbit3$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit3 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},
 {running_nodes,[rabbit@rabbit2,rabbit@rabbit3]}]
...done.
rabbit3$ rabbitmqctl stop
Stopping and halting node rabbit@rabbit3 ...done.
rabbit2$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit2 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},
 {running_nodes,[rabbit@rabbit2]}]
...done.
</code></pre><p><strong><em>&#x53D1;&#x73B0;&#x96C6;&#x7FA4;&#x4E2D;&#x7684;&#x8282;&#x70B9; stop &#x4E4B;&#x540E;&#xFF0C;&#x68C0;&#x67E5;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#xFF08;rabbitmqctl cluster_status&#xFF09;&#xFF0C;&#x4F1A;&#x663E;&#x793A;</em></strong></p>
<p><strong><em>&#x96C6;&#x7FA4;&#x4FE1;&#x606F;&#xFF08;{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]}&#xFF09;</em></strong></p>
<p><strong><em>&#x548C;&#x5B58;&#x6D3B;&#x8282;&#x70B9;&#xFF08;{running_nodes,[rabbit@rabbit3,rabbit@rabbit2]}&#xFF09;</em></strong></p>
<p>Now we start the nodes again, checking on the cluster status as we go along:</p>
<pre><code>rabbit1$ rabbitmq-server -detached
rabbit1$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit1 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},
 {running_nodes,[rabbit@rabbit2,rabbit@rabbit1]}]
...done.
rabbit2$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit2 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},
 {running_nodes,[rabbit@rabbit1,rabbit@rabbit2]}]
...done.
rabbit3$ rabbitmq-server -detached
rabbit1$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit1 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},
 {running_nodes,[rabbit@rabbit2,rabbit@rabbit1,rabbit@rabbit3]}]
...done.
rabbit2$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit2 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},
 {running_nodes,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]
...done.
rabbit3$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit3 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2,rabbit@rabbit3]}]},
 {running_nodes,[rabbit@rabbit2,rabbit@rabbit1,rabbit@rabbit3]}]
...done.
</code></pre><p><strong><em>&#x91CD;&#x542F;&#x8282;&#x70B9;&#x4E4B;&#x540E;&#xFF0C;&#x96C6;&#x7FA4;&#x4E2D;&#x5B58;&#x6D3B;&#x8282;&#x70B9;&#x4FE1;&#x606F;&#x66F4;&#x65B0;&#x3002;</em></strong></p>
<p>There are some important caveats:</p>
<p>When the entire cluster is brought down, the last node to go down must be the first node to be brought online. If this doesn&apos;t happen, the nodes will wait 30 seconds for the last disc node to come back online, and fail afterwards.</p>
<p>If the last node to go offline cannot be brought back up, it can be removed from the cluster using the forget_cluster_node command - consult the rabbitmqctl manpage for more information.</p>
<p><strong><em>&#x96C6;&#x7FA4;&#x4E2D;&#x6700;&#x540E;&#x505C;&#x6B62;&#x7684;&#x8282;&#x70B9;&#x8981;&#x6700;&#x5148;&#x8D77;&#x6765;&#x3002;</em></strong></p>
<p><strong><em>&#x5426;&#x5219;&#xFF0C;&#x542F;&#x52A8;&#x7684;&#x8282;&#x70B9;&#x4F1A;&#x7B49;30S&#xFF08;&#x7B49;&#x5F85;&#x6700;&#x540E;&#x90A3;&#x4E2A;&#x78C1;&#x76D8;&#x8282;&#x70B9;&#x542F;&#x52A8;&#xFF09;&#xFF0C;&#x6700;&#x7EC8;&#x5931;&#x8D25;&#x3002;</em></strong></p>
<p><strong><em>&#x5982;&#x679C;&#x6700;&#x540E;&#x505C;&#x6B62;&#x7684;&#x8282;&#x70B9;&#x8D77;&#x4E0D;&#x6765;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; forget_cluster_node &#x628A;&#x5B83;&#x5254;&#x9664;&#x3002;</em></strong></p>
<p>If all cluster nodes stop in a simultaneous and uncontrolled manner (for example with a power cut) you can be left with a situation in which all nodes think that some other node stopped after them. In this case you can use the force_boot command on one node to make it bootable again - consult the rabbitmqctl manpage for more information.</p>
<p><strong><em>&#x5982;&#x679C;&#x6240;&#x6709;&#x7684;&#x96C6;&#x7FA4;&#x8282;&#x70B9;&#x540C;&#x65F6;&#x4EE5;&#x4E0D;&#x53D7;&#x63A7;&#x5236;&#x7684;&#x65B9;&#x5F0F;&#x505C;&#x6B62;(&#x4F8B;&#x5982;&#xFF0C;&#x65AD;&#x7535;)&#xFF0C;&#x73B0;&#x5728;&#x7684;&#x60C5;&#x5F62;&#x53EF;&#x89C6;&#x4E3A;&#xFF1A;&#x6240;&#x6709;&#x8282;&#x70B9;&#x90FD;&#x8BA4;&#x4E3A;&#x5176;&#x4ED6;&#x8282;&#x70B9;&#x662F;&#x5728;&#x5B83;&#x4EEC;&#x4E4B;&#x540E;&#x505C;&#x6B62;&#x7684;&#x3002;</em></strong></p>
<p><strong><em>&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x4F7F;&#x7528; force_boot &#x547D;&#x4EE4;&#x6765;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x5B83;&#x3002;</em></strong></p>
<h4 id="breaking-up-a-cluster">Breaking Up a Cluster</h4>
<p>Sometimes it is necessary to remove a node from a cluster. The operator has to do this explicitly using a rabbitmqctl command.</p>
<p>Some peer discovery mechanisms support node health checks and forced removal of nodes not known to the discovery backend. That feature is opt-in (disabled by default).</p>
<p>We first remove rabbit@rabbit3 from the cluster, returning it to independent operation. To do that, on rabbit@rabbit3 we stop the RabbitMQ application, reset the node, and restart the RabbitMQ application.</p>
<p><strong><em>&#x8FD9;&#x91CC; rabbit@rabbit3 &#x4E3B;&#x52A8;&#x4ECE;&#x96C6;&#x7FA4;&#x4E2D;&#x79BB;&#x5F00;&#xFF08;&#x4E3B;&#x52A8;&#x79BB;&#x5F00;&#xFF09;</em></strong></p>
<pre><code>rabbit3$ rabbitmqctl stop_app
Stopping node rabbit@rabbit3 ...done.
rabbit3$ rabbitmqctl reset
Resetting node rabbit@rabbit3 ...done.
rabbit3$ rabbitmqctl start_app
Starting node rabbit@rabbit3 ...done.
</code></pre><p>Note that it would have been equally valid to list rabbit@rabbit3 as a node.</p>
<p>Running the cluster_status command on the nodes confirms that rabbit@rabbit3 now is no longer part of the cluster and operates independently:</p>
<p><strong><em>&#x53EF;&#x4EE5;&#x53D1;&#x73B0; rabbit@rabbit3 &#x73B0;&#x5728;&#x662F;&#x4E00;&#x4E2A;&#x5355;&#x70B9;&#x96C6;&#x7FA4;&#x3002;</em></strong></p>
<pre><code>rabbit1$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit1 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2]}]},
 {running_nodes,[rabbit@rabbit2,rabbit@rabbit1]}]
...done.
rabbit2$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit2 ...
[{nodes,[{disc,[rabbit@rabbit1,rabbit@rabbit2]}]},
 {running_nodes,[rabbit@rabbit1,rabbit@rabbit2]}]
...done.
rabbit3$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit3 ...
[{nodes,[{disc,[rabbit@rabbit3]}]},{running_nodes,[rabbit@rabbit3]}]
...done.
</code></pre><p>We can also remove nodes remotely. This is useful, for example, when having to deal with an unresponsive node. We can for example remove rabbit@rabbi1 from rabbit@rabbit2.</p>
<p><strong><em>&#x8FD9;&#x91CC;&#x96C6;&#x7FA4;&#x5C06; rabbit@rabbit1 &#x5254;&#x9664;&#xFF08;&#x88AB;&#x52A8;&#x79BB;&#x5F00;&#xFF09;</em></strong></p>
<pre><code>rabbit1$ rabbitmqctl stop_app
Stopping node rabbit@rabbit1 ...done.
rabbit2$ rabbitmqctl forget_cluster_node rabbit@rabbit1
Removing node rabbit@rabbit1 from cluster ...
...done.
</code></pre><p>Note that rabbit1 still thinks its clustered with rabbit2, and trying to start it will result in an error. We will need to reset it to be able to start it again.</p>
<p><strong><em>&#x88AB;&#x52A8;&#x79BB;&#x5F00;&#x7684; rabbit@rabbit1 &#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x53D1;&#x73B0;&#x88AB;&#x96C6;&#x7FA4;&#x62D2;&#x7EDD;&#xFF08;&#x4F60;&#x8BA4;&#x4E3A;&#x81EA;&#x5DF1;&#x662F;&#x96C6;&#x7FA4;&#x7684;&#x4E00;&#x4EFD;&#x5B50;&#xFF0C;&#x4F46;&#x96C6;&#x7FA4;&#x53EF;&#x4E0D;&#x8FD9;&#x6837;&#x8BA4;&#x4E3A;&#xFF09;</em></strong></p>
<p><strong><em>reset &#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x8D77;&#x4E00;&#x4E2A;&#x5355;&#x70B9;&#x96C6;&#x7FA4;</em></strong></p>
<pre><code>rabbit1$ rabbitmqctl start_app
Starting node rabbit@rabbit1 ...
Error: inconsistent_cluster: Node rabbit@rabbit1 thinks it&apos;s clustered with node rabbit@rabbit2, but rabbit@rabbit2 disagrees
rabbit1$ rabbitmqctl reset
Resetting node rabbit@rabbit1 ...done.
rabbit1$ rabbitmqctl start_app
Starting node rabbit@mcnulty ...
...done.
</code></pre><p>The cluster_status command now shows all three nodes operating as independent RabbitMQ brokers:</p>
<p><strong><em>&#x73B0;&#x5728;&#x7684;&#x60C5;&#x5F62;&#x662F;&#xFF0C;&#x96C6;&#x7FA4;&#x4E00;&#x5206;&#x4E3A;&#x4E09;&#xFF1A;3&#x4E2A;&#x5355;&#x70B9;&#x96C6;&#x7FA4;</em></strong></p>
<pre><code>rabbit1$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit1 ...
[{nodes,[{disc,[rabbit@rabbit1]}]},{running_nodes,[rabbit@rabbit1]}]
...done.
rabbit2$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit2 ...
[{nodes,[{disc,[rabbit@rabbit2]}]},{running_nodes,[rabbit@rabbit2]}]
...done.
rabbit3$ rabbitmqctl cluster_status
Cluster status of node rabbit@rabbit3 ...
[{nodes,[{disc,[rabbit@rabbit3]}]},{running_nodes,[rabbit@rabbit3]}]
...done.
</code></pre><p>Note that rabbit@rabbit2 retains the residual state of the cluster, whereas rabbit@rabbit1 and rabbit@rabbit3 are freshly initialised RabbitMQ brokers. If we want to re-initialise rabbit@rabbit2 we follow the same steps as for the other nodes:</p>
<pre><code>rabbit2$ rabbitmqctl stop_app
Stopping node rabbit@rabbit2 ...done.
rabbit2$ rabbitmqctl reset
Resetting node rabbit@rabbit2 ...done.
rabbit2$ rabbitmqctl start_app
          Starting node rabbit@rabbit2 ...done.
</code></pre><p>Besides rabbitmqctl forget_cluster_node and the automatic cleanup of unknown nodes by some peer discovery plugins, there are no scenarios in which a RabbitMQ node will permanently remove its peer node from a cluster.</p>
<p><strong><em>&#x8FD9;&#x91CC; rabbit@rabbit2 &#x4FDD;&#x7559;&#x4E86;&#x96C6;&#x7FA4;&#x7684;&#x539F;&#x59CB;&#x4FE1;&#x606F;&#xFF08;&#x56E0;&#x4E3A; rabbit1 &#x548C; rabbit3 &#x90FD; reset &#x8FC7;&#xFF0C;&#x91CD;&#x7F6E;&#x6E05;&#x7A7A;&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;  rabbit1 &#x548C; rabbit3 &#x5F53;&#x505A;&#x65B0;&#x8282;&#x70B9;&#x52A0;&#x5165; rabbit@rabbit2 &#x96C6;&#x7FA4;&#xFF08;&#x5982;&#x679C;&#x4E0D;&#x884C;</em></strong>&#xFF0C;<strong>&#x53EF;&#x4EE5;&#x6539;&#x540D;&#x518D;&#x6218;!!!!</strong>&#xFF09;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="RabbitMQ四种发送方式区别.html" class="navigation navigation-prev " aria-label="Previous page: 4.2 RabbitMQ四种发送方式区别">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="RabbitMQ多地址连接.html" class="navigation navigation-next " aria-label="Next page: 4.4 RabbitMQ多地址连接">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"4.3 RabbitMQ安装全记录","level":"1.5.3","depth":2,"next":{"title":"4.4 RabbitMQ多地址连接","level":"1.5.4","depth":2,"path":"rabbitmq/RabbitMQ多地址连接.md","ref":"rabbitmq/RabbitMQ多地址连接.md","articles":[]},"previous":{"title":"4.2 RabbitMQ四种发送方式区别","level":"1.5.2","depth":2,"path":"rabbitmq/RabbitMQ四种发送方式区别.md","ref":"rabbitmq/RabbitMQ四种发送方式区别.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"rabbitmq/RabbitMQ安装全记录.md","mtime":"2018-06-04T02:32:47.841Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-06-26T13:49:56.226Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

