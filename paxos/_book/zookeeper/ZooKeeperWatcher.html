
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>6.3 ZooKeeperWatcher · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="ZooKeeper连接.html" />
    
    
    <link rel="prev" href="ZooKeeper权限控制.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    0 Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../">
            
                <a href="../">
            
                    
                    1 Algorithm
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../algorithm/CAP.html">
            
                <a href="../algorithm/CAP.html">
            
                    
                    1.1 CAP理论
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../algorithm/ZAB协议.html">
            
                <a href="../algorithm/ZAB协议.html">
            
                    
                    1.2 ZAB协议
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../algorithm/分布式锁.html">
            
                <a href="../algorithm/分布式锁.html">
            
                    
                    1.3 分布式锁
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../algorithm/raft-zh_cn.html">
            
                <a href="../algorithm/raft-zh_cn.html">
            
                    
                    1.4 RAFT算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../algorithm/PAXOS.html">
            
                <a href="../algorithm/PAXOS.html">
            
                    
                    1.5 3分钟理解PAXOS算法
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../">
            
                <a href="../">
            
                    
                    2 Java
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../java/从实际案例聊聊Java应用的GC优化.html">
            
                <a href="../java/从实际案例聊聊Java应用的GC优化.html">
            
                    
                    2.1 JavaGC优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../java/设计模式23.html">
            
                <a href="../java/设计模式23.html">
            
                    
                    2.2 设计模式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../java/Effective Java.html">
            
                <a href="../java/Effective Java.html">
            
                    
                    2.3 EffectiveJava
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../java/Java学习笔记.html">
            
                <a href="../java/Java学习笔记.html">
            
                    
                    2.4 Java学习笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../java/JDK相关.html">
            
                <a href="../java/JDK相关.html">
            
                    
                    2.5 JDK相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../java/AlibabaJavaCodingGuidelines.html">
            
                <a href="../java/AlibabaJavaCodingGuidelines.html">
            
                    
                    2.6 阿里Java编码规范整理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../java/Java程序执行次序.html">
            
                <a href="../java/Java程序执行次序.html">
            
                    
                    2.7 深入了解Java程序执行顺序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../java/JDK定时任务对比.html">
            
                <a href="../java/JDK定时任务对比.html">
            
                    
                    2.8 JDK定时任务对比
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../">
            
                <a href="../">
            
                    
                    3 SpringBoot
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../springboot/SpringBoot-pom-xml.html">
            
                <a href="../springboot/SpringBoot-pom-xml.html">
            
                    
                    3.1 SpringBoot的pom.xml
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../springboot/SpringBoot注解.html">
            
                <a href="../springboot/SpringBoot注解.html">
            
                    
                    3.2 SpringBoot的注解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../springboot/Eureka.html">
            
                <a href="../springboot/Eureka.html">
            
                    
                    3.3 Eureka
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../springboot/LogBack相关.html">
            
                <a href="../springboot/LogBack相关.html">
            
                    
                    3.4 LogBack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../springboot/Maven相关.html">
            
                <a href="../springboot/Maven相关.html">
            
                    
                    3.5 Maven
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../springboot/OAuth2.0.html">
            
                <a href="../springboot/OAuth2.0.html">
            
                    
                    3.6 OAuth2.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../springboot/SpringBoot排错.html">
            
                <a href="../springboot/SpringBoot排错.html">
            
                    
                    3.7 SpringBoot排错
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../springboot/SpringBoot排雷现场.html">
            
                <a href="../springboot/SpringBoot排雷现场.html">
            
                    
                    3.8 SpringBoot排雷现场
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../springboot/SpringBoot释疑.html">
            
                <a href="../springboot/SpringBoot释疑.html">
            
                    
                    3.9 SpringBoot释疑
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../springboot/SpringBoot引入log4j的配置.html">
            
                <a href="../springboot/SpringBoot引入log4j的配置.html">
            
                    
                    3.10 SpringBoot引入log4j的配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../springboot/SpringBoot启动脚本.html">
            
                <a href="../springboot/SpringBoot启动脚本.html">
            
                    
                    3.11 SpringBoot启动脚本
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../springboot/SpringBoot定时任务.html">
            
                <a href="../springboot/SpringBoot定时任务.html">
            
                    
                    3.12 SpringBoot定时任务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../springboot/SpringBoot初始化任务.html">
            
                <a href="../springboot/SpringBoot初始化任务.html">
            
                    
                    3.13 SpringBoot初始化任务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../springboot/SpringBootRedis.html">
            
                <a href="../springboot/SpringBootRedis.html">
            
                    
                    3.14 SpringBootRedis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.15" data-path="../springboot/SpringBootRabbitMQ.html">
            
                <a href="../springboot/SpringBootRabbitMQ.html">
            
                    
                    3.15 SpringBootRabbitMQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.16" data-path="../springboot/packaging为pom标签的用法.html">
            
                <a href="../springboot/packaging为pom标签的用法.html">
            
                    
                    3.16 pom标签
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.17" data-path="../springboot/客户端配置更新.html">
            
                <a href="../springboot/客户端配置更新.html">
            
                    
                    3.17 客户端配置更新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.18" data-path="../springboot/SpringBoot配置优先级.html">
            
                <a href="../springboot/SpringBoot配置优先级.html">
            
                    
                    3.18 SpringBoot配置优先级
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../">
            
                <a href="../">
            
                    
                    4 RabbitMQ
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../rabbitmq/RabbitMQ相关.html">
            
                <a href="../rabbitmq/RabbitMQ相关.html">
            
                    
                    4.1 RabbitMQ相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../rabbitmq/RabbitMQ四种发送方式区别.html">
            
                <a href="../rabbitmq/RabbitMQ四种发送方式区别.html">
            
                    
                    4.2 RabbitMQ四种发送方式区别
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../rabbitmq/RabbitMQ安装全记录.html">
            
                <a href="../rabbitmq/RabbitMQ安装全记录.html">
            
                    
                    4.3 RabbitMQ安装全记录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../rabbitmq/RabbitMQ多地址连接.html">
            
                <a href="../rabbitmq/RabbitMQ多地址连接.html">
            
                    
                    4.4 RabbitMQ多地址连接
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../">
            
                <a href="../">
            
                    
                    5 Shell
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../shell/免密登陆.html">
            
                <a href="../shell/免密登陆.html">
            
                    
                    5.1 免密登陆
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../shell/iptables命令.html">
            
                <a href="../shell/iptables命令.html">
            
                    
                    5.2 iptables命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../shell/scp命令.html">
            
                <a href="../shell/scp命令.html">
            
                    
                    5.3 scp命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../shell/shell特殊变量的含义.html">
            
                <a href="../shell/shell特殊变量的含义.html">
            
                    
                    5.4 shell特殊变量的含义
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../shell/TCP最大连接数.html">
            
                <a href="../shell/TCP最大连接数.html">
            
                    
                    5.5 TCP最大连接数
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../">
            
                <a href="../">
            
                    
                    6 ZooKeeper
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="ZooKeeper集群安装.html">
            
                <a href="ZooKeeper集群安装.html">
            
                    
                    6.1 ZooKeeper集群安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="ZooKeeper权限控制.html">
            
                <a href="ZooKeeper权限控制.html">
            
                    
                    6.2 ZooKeeper权限控制
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7.3" data-path="ZooKeeperWatcher.html">
            
                <a href="ZooKeeperWatcher.html">
            
                    
                    6.3 ZooKeeperWatcher
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="ZooKeeper连接.html">
            
                <a href="ZooKeeper连接.html">
            
                    
                    6.4 ZooKeeper连接
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../pic/PIC.html">
            
                <a href="../pic/PIC.html">
            
                    
                    7 Pic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../">
            
                <a href="../">
            
                    
                    8 Other
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../other/GitBook.html">
            
                <a href="../other/GitBook.html">
            
                    
                    1 GitBook
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../other/MySQL.html">
            
                <a href="../other/MySQL.html">
            
                    
                    2 MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../other/MD语法.html">
            
                <a href="../other/MD语法.html">
            
                    
                    3 MarkDown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../other/windows相关.html">
            
                <a href="../other/windows相关.html">
            
                    
                    4 Windows相关
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../other/Sublime Text 3 快捷键精华版.html">
            
                <a href="../other/Sublime Text 3 快捷键精华版.html">
            
                    
                    5 SublimeText3快捷键精华版
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../other/zabbix.html">
            
                <a href="../other/zabbix.html">
            
                    
                    6 Zabbix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../other/Nginx安装.html">
            
                <a href="../other/Nginx安装.html">
            
                    
                    7 Nginx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../other/TBSchedule.html">
            
                <a href="../other/TBSchedule.html">
            
                    
                    8 TBSchedule
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../other/webdis安装.html">
            
                <a href="../other/webdis安装.html">
            
                    
                    9 webdis安装
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >6.3 ZooKeeperWatcher</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h3 id="zookeeper-watches">ZooKeeper Watches</h3>
<p>All of the read operations in ZooKeeper - getData(), getChildren(), and exists() - have the option of setting a watch as a side effect. Here is ZooKeeper&apos;s definition of a watch: a watch event is one-time trigger, sent to the client that set the watch, which occurs when the data for which the watch was set changes. There are three key points to consider in this definition of a watch:</p>
<p>&#x53EA;&#x6709;3&#x79CD;&#x8BFB;&#x64CD;&#x4F5C;&#x624D;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E; watch&#xFF1A;&#xFF08;&#x6CE8;&#x91CA;&#x6765;&#x81EA;ZK&#x5BA2;&#x6237;&#x7AEF;&#x7684;API&#xFF09;</p>
<h4 id="getdata">getData()</h4>
<p>&#x89E6;&#x53D1; getData &#x51FD;&#x6570;Watcher &#x7684;&#x884C;&#x4E3A;&#xFF1A;&#x5220;&#x9664;&#x5F53;&#x524D;&#x8282;&#x70B9;&#xFF0C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x6570;&#x636E;&#x66F4;&#x65B0;</p>
<p>sets data on the node, or deletes the node.</p>
<h4 id="getchildren">getChildren()</h4>
<p>&#x89E6;&#x53D1; getChildren &#x51FD;&#x6570;Watcher &#x7684;&#x884C;&#x4E3A;&#xFF1A;&#x5220;&#x9664;&#x5F53;&#x524D;&#x8282;&#x70B9;&#xFF0C;&#x521B;&#x5EFA;&#x6216;&#x5220;&#x9664;&#x5176;&#x5B50;&#x8282;&#x70B9;&#xFF08;&#x5B50;&#x8282;&#x70B9;&#x66F4;&#x65B0;&#x4E5F;&#x4F1A;&#x89E6;&#x53D1;&#xFF1F;---&#x5E76;&#x4E0D;&#x4F1A;&#xFF09;</p>
<p>deletes the node of the given path or creates/delete a child under the node.</p>
<h4 id="exists">exists()</h4>
<p>&#x89E6;&#x53D1; exists &#x51FD;&#x6570;Watcher &#x7684;&#x884C;&#x4E3A;&#xFF1A;&#x521B;&#x5EFA;&#x6216;&#x5220;&#x9664;&#x5F53;&#x524D;&#x8282;&#x70B9;&#xFF0C;&#x5F53;&#x524D;&#x8282;&#x70B9;&#x6570;&#x636E;&#x66F4;&#x65B0;</p>
<p>creates/delete the node or sets the data on the node.</p>
<h4 id="watch-&#x6709;3&#x4E2A;&#x7279;&#x70B9;&#xFF1A;">watch &#x6709;3&#x4E2A;&#x7279;&#x70B9;&#xFF1A;</h4>
<h4 id="1-one-time-trigger">1. One-time trigger</h4>
<p>One watch event will be sent to the client when the data has changed. For example, if a client does a getData(&quot;/znode1&quot;, true) and later the data for /znode1 is changed or deleted, the client will get a watch event for /znode1. If /znode1 changes again, no watch event will be sent unless the client has done another read that sets a new watch.</p>
<p>&#x4E00;&#x4E2A;watch&#x4E8B;&#x4EF6;&#x5C06;&#x4F1A;&#x5728;&#x6570;&#x636E;&#x53D1;&#x751F;&#x53D8;&#x66F4;&#x65F6;&#x53D1;&#x9001;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x5BA2;&#x6237;&#x7AEF;&#x6267;&#x884C;&#x64CD;&#x4F5C;getData(&#x201C;/znode1&#x2033;, true)&#xFF0C;&#x800C;&#x540E;/znode1 &#x53D1;&#x751F;&#x53D8;&#x66F4;&#x6216;&#x662F;&#x5220;&#x9664;&#x4E86;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x90FD;&#x4F1A;&#x5F97;&#x5230;&#x4E00;&#x4E2A;/znode1 &#x7684;watch&#x4E8B;&#x4EF6;&#x3002;&#x5982;&#x679C;/znode1 &#x518D;&#x6B21;&#x53D1;&#x751F;&#x53D8;&#x66F4;&#xFF0C;&#x5219;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#x65B0;&#x7684;watch&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x662F;&#x4E0D;&#x4F1A;&#x518D;&#x7ED9;&#x8FD9;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;watch&#x4E8B;&#x4EF6;&#x7684;&#x3002;</p>
<h4 id="&#x6CE8;&#x518C;&#x53EA;&#x80FD;&#x786E;&#x4FDD;&#x4E00;&#x6B21;&#x6D88;&#x8D39;">&#x6CE8;&#x518C;&#x53EA;&#x80FD;&#x786E;&#x4FDD;&#x4E00;&#x6B21;&#x6D88;&#x8D39;</h4>
<p>&#x65E0;&#x8BBA;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x8FD8;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4E00;&#x65E6;&#x4E00;&#x4E2A; Watcher &#x88AB;&#x89E6;&#x53D1;&#xFF0C;ZooKeeper &#x90FD;&#x4F1A;&#x5C06;&#x5176;&#x4ECE;&#x76F8;&#x5E94;&#x7684;&#x5B58;&#x50A8;&#x4E2D;&#x79FB;&#x9664;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5728; Watcher &#x7684;&#x4F7F;&#x7528;&#x4E0A;&#x8981;&#x8BB0;&#x4F4F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#x9700;&#x8981;&#x53CD;&#x590D;&#x6CE8;&#x518C;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#x6709;&#x6548;&#x5730;&#x51CF;&#x8F7B;&#x4E86;&#x670D;&#x52A1;&#x7AEF;&#x7684;&#x538B;&#x529B;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6CE8;&#x518C;&#x4E00;&#x4E2A; Watcher &#x4E4B;&#x540E;&#x4E00;&#x76F4;&#x6709;&#x6548;&#xFF0C;&#x90A3;&#x4E48;&#x9488;&#x5BF9;&#x90A3;&#x4E9B;&#x66F4;&#x65B0;&#x975E;&#x5E38;&#x9891;&#x7E41;&#x7684;&#x8282;&#x70B9;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x4F1A;&#x4E0D;&#x65AD;&#x5730;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x4E8B;&#x4EF6;&#x901A;&#x77E5;&#xFF0C;&#x8FD9;&#x65E0;&#x8BBA;&#x5BF9;&#x4E8E;&#x7F51;&#x7EDC;&#x8FD8;&#x662F;&#x670D;&#x52A1;&#x7AEF;&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;&#x90FD;&#x975E;&#x5E38;&#x5927;&#x3002;</p>
<h4 id="2-sent-to-the-client">2. Sent to the client</h4>
<p>This implies that an event is on the way to the client, but may not reach the client before the successful return code to the change operation reaches the client that initiated the change. Watches are sent asynchronously to watchers. ZooKeeper provides an ordering guarantee: a client will never see a change for which it has set a watch until it first sees the watch event. Network delays or other factors may cause different clients to see watches and return codes from updates at different times. The key point is that everything seen by the different clients will have a consistent order.</p>
<p>&#x8FD9;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x4F1A;&#x53D1;&#x9001;&#x7ED9;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x4F46;&#x53EF;&#x80FD;&#x5728;&#x64CD;&#x4F5C;&#x6210;&#x529F;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x5230;&#x8FBE;&#x53D1;&#x8D77;&#x53D8;&#x52A8;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4E4B;&#x524D;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x8FD8;&#x6CA1;&#x6709;&#x9001;&#x8FBE;watch&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x3002;Watch&#x662F;&#x5F02;&#x6B65;&#x53D1;&#x9001;&#x7684;&#x3002;&#x4F46;ZooKeeper&#x4FDD;&#x8BC1;&#x4E86;&#x4E00;&#x4E2A;&#x987A;&#x5E8F;&#xFF1A;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x5728;&#x6536;&#x5230;watch&#x4E8B;&#x4EF6;&#x4E4B;&#x524D;&#xFF0C;&#x4E00;&#x5B9A;&#x4E0D;&#x4F1A;&#x770B;&#x5230;&#x5B83;&#x8BBE;&#x7F6E;&#x8FC7;watch&#x7684;&#x503C;&#x7684;&#x53D8;&#x52A8;&#x3002;&#x7F51;&#x7EDC;&#x65F6;&#x5EF6;&#x548C;&#x5176;&#x4ED6;&#x56E0;&#x7D20;&#x53EF;&#x80FD;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0D;&#x540C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x770B;&#x5230;watch&#x548C;&#x66F4;&#x65B0;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x65F6;&#x95F4;&#x4E0D;&#x540C;&#x3002;&#x4F46;&#x5173;&#x952E;&#x70B9;&#x662F;&#xFF0C;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x6240;&#x770B;&#x5230;&#x7684;&#x6BCF;&#x4EF6;&#x4E8B;&#x90FD;&#x662F;&#x6709;&#x987A;&#x5E8F;&#x7684;&#x3002;</p>
<h4 id="&#x5BA2;&#x6237;&#x7AEF;&#x4E32;&#x884C;&#x6267;&#x884C;">&#x5BA2;&#x6237;&#x7AEF;&#x4E32;&#x884C;&#x6267;&#x884C;</h4>
<p>&#x5BA2;&#x6237;&#x7AEF; Watcher &#x56DE;&#x8C03;&#x7684;&#x8FC7;&#x7A0B;&#x662F;&#x4E00;&#x4E2A;&#x4E32;&#x884C;&#x540C;&#x6B65;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x8FD9;&#x4E3A;&#x6211;&#x4EEC;&#x4FDD;&#x8BC1;&#x4E86;&#x987A;&#x5E8F;&#xFF0C;&#x540C;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6CE8;&#x610F;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x56E0;&#x4E3A;&#x4E00;&#x4E2A; Watcher &#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;&#x5F71;&#x54CD;&#x4E86;&#x6574;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x7684; Watcher &#x56DE;&#x8C03;&#x3002;</p>
<h4 id="3-the-data-for-which-the-watch-was-set">3. The data for which the watch was set</h4>
<p>This refers to the different ways a node can change. It helps to think of ZooKeeper as maintaining two lists of watches: data watches and child watches. getData() and exists() set data watches. getChildren() sets child watches. Alternatively, it may help to think of watches being set according to the kind of data returned. getData() and exists() return information about the data of the node, whereas getChildren() returns a list of children. Thus, setData() will trigger data watches for the znode being set (assuming the set is successful). A successful create() will trigger a data watch for the znode being created and a child watch for the parent znode. A successful delete() will trigger both a data watch and a child watch (since there can be no more children) for a znode being deleted as well as a child watch for the parent znode.</p>
<p>&#x8FD9;&#x662F;&#x6307;&#x8282;&#x70B9;&#x53D1;&#x751F;&#x53D8;&#x52A8;&#x7684;&#x4E0D;&#x540C;&#x65B9;&#x5F0F;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;ZooKeeper&#x7EF4;&#x62A4;&#x4E86;&#x4E24;&#x4E2A;watch&#x5217;&#x8868;&#xFF1A;data watch&#x548C;child watch&#x3002;getData()&#x548C;exists()&#x8BBE;&#x7F6E;data watch&#xFF0C;&#x800C;getChildren()&#x8BBE;&#x7F6E;child watch&#x3002;&#x6216;&#x8005;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;watch&#x662F;&#x6839;&#x636E;&#x8FD4;&#x56DE;&#x503C;&#x8BBE;&#x7F6E;&#x7684;&#x3002;getData()&#x548C;exists()&#x8FD4;&#x56DE;&#x8282;&#x70B9;&#x672C;&#x8EAB;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x800C;getChildren()&#x8FD4;&#x56DE;&#x5B50;&#x8282;&#x70B9;&#x7684;&#x5217;&#x8868;&#x3002;&#x56E0;&#x6B64;&#xFF0C;setData()&#x4F1A;&#x89E6;&#x53D1;znode&#x4E0A;&#x8BBE;&#x7F6E;&#x7684;data watch&#xFF08;&#x5982;&#x679C;set&#x6210;&#x529F;&#x7684;&#x8BDD;&#xFF09;&#x3002;&#x4E00;&#x4E2A;&#x6210;&#x529F;&#x7684;create() &#x64CD;&#x4F5C;&#x4F1A;&#x89E6;&#x53D1;&#x88AB;&#x521B;&#x5EFA;&#x7684;znode&#x4E0A;&#x7684;&#x6570;&#x636E;watch&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x7236;&#x8282;&#x70B9;&#x4E0A;&#x7684;child watch&#x3002;&#x800C;&#x4E00;&#x4E2A;&#x6210;&#x529F;&#x7684; delete()&#x64CD;&#x4F5C;&#x5C06;&#x4F1A;&#x540C;&#x65F6;&#x89E6;&#x53D1;&#x4E00;&#x4E2A;znode&#x7684;data watch&#x548C;child watch&#xFF08;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x5C31;&#x6CA1;&#x6709;&#x5B50;&#x8282;&#x70B9;&#x4E86;&#xFF09;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x89E6;&#x53D1;&#x5176;&#x7236;&#x8282;&#x70B9;&#x7684;child watch&#x3002;</p>
<p>Watches are maintained locally at the ZooKeeper server to which the client is connected. This allows watches to be lightweight to set, maintain, and dispatch. When a client connects to a new server, the watch will be triggered for any session events. Watches will not be received while disconnected from a server. When a client reconnects, any previously registered watches will be reregistered and triggered if needed. In general this all occurs transparently. There is one case where a watch may be missed: a watch for the existence of a znode not yet created will be missed if the znode is created and deleted while disconnected.</p>
<p>Watch&#x7531;client&#x8FDE;&#x63A5;&#x4E0A;&#x7684;ZooKeeper&#x670D;&#x52A1;&#x5668;&#x5728;&#x672C;&#x5730;&#x7EF4;&#x62A4;&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x51CF;&#x5C0F;&#x8BBE;&#x7F6E;&#x3001;&#x7EF4;&#x62A4;&#x548C;&#x5206;&#x53D1;watch&#x7684;&#x5F00;&#x9500;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x5230;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x65F6;&#xFF0C;watch&#x5C06;&#x4F1A;&#x88AB;&#x4EE5;&#x4EFB;&#x610F;&#x4F1A;&#x8BDD;&#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x3002;&#x5F53;&#x4E0E;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x5931;&#x53BB;&#x8FDE;&#x63A5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x662F;&#x65E0;&#x6CD5;&#x63A5;&#x6536;&#x5230;watch&#x7684;&#x3002;&#x800C;&#x5F53;client&#x91CD;&#x65B0;&#x8FDE;&#x63A5;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#xFF0C;&#x6240;&#x6709;&#x5148;&#x524D;&#x6CE8;&#x518C;&#x8FC7;&#x7684;watch&#xFF0C;&#x90FD;&#x4F1A;&#x88AB;&#x91CD;&#x65B0;&#x6CE8;&#x518C;&#x3002;&#x901A;&#x5E38;&#x8FD9;&#x662F;&#x5B8C;&#x5168;&#x900F;&#x660E;&#x7684;&#x3002;&#x53EA;&#x6709;&#x5728;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;watch&#x53EF;&#x80FD;&#x4F1A;&#x4E22;&#x5931;&#xFF1A;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x672A;&#x521B;&#x5EFA;&#x7684;znode&#x7684;exist watch&#xFF0C;&#x5982;&#x679C;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x671F;&#x95F4;&#x88AB;&#x521B;&#x5EFA;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x968F;&#x540E;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x4E0A;&#x4E4B;&#x524D;&#x53C8;&#x5220;&#x9664;&#x4E86;&#xFF0C;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;watch&#x4E8B;&#x4EF6;&#x53EF;&#x80FD;&#x4F1A;&#x88AB;&#x4E22;&#x5931;&#x3002;</p>
<h4 id="&#x8F7B;&#x91CF;&#x7EA7;&#x8BBE;&#x8BA1;">&#x8F7B;&#x91CF;&#x7EA7;&#x8BBE;&#x8BA1;</h4>
<p>WatchedEvent &#x662F; ZooKeeper &#x6574;&#x4E2A; Watcher &#x901A;&#x77E5;&#x673A;&#x5236;&#x7684;&#x6700;&#x5C0F;&#x901A;&#x77E5;&#x5355;&#x5143;&#xFF0C;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E2D;&#x53EA;&#x5305;&#x542B;&#x4E09;&#x90E8;&#x5206;&#x7684;&#x5185;&#x5BB9;&#xFF1A;&#x901A;&#x77E5;&#x72B6;&#x6001;&#x3001;&#x4E8B;&#x4EF6;&#x7C7B;&#x578B;&#x548C;&#x8282;&#x70B9;&#x8DEF;&#x5F84;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;Watcher &#x901A;&#x77E5;&#x975E;&#x5E38;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x4F1A;&#x544A;&#x8BC9;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x751F;&#x4E86;&#x4E8B;&#x4EF6;&#xFF0C;&#x800C;&#x4E0D;&#x4F1A;&#x8BF4;&#x660E;&#x4E8B;&#x4EF6;&#x7684;&#x5177;&#x4F53;&#x5185;&#x5BB9;&#x3002;</p>
<p>&#x4F8B;&#x5982;&#x9488;&#x5BF9; NodeDataChanged &#x4E8B;&#x4EF6;&#xFF0C;ZooKeeper &#x7684; Watcher &#x53EA;&#x4F1A;&#x901A;&#x77E5;&#x5BA2;&#x6237;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x8282;&#x70B9;&#x7684;&#x6570;&#x636E;&#x5185;&#x5BB9;&#x53D1;&#x751F;&#x4E86;&#x53D8;&#x66F4;&#xFF0C;&#x800C;&#x5BF9;&#x4E8E;&#x539F;&#x59CB;&#x6570;&#x636E;&#x4EE5;&#x53CA;&#x53D8;&#x66F4;&#x540E;&#x7684;&#x65B0;&#x6570;&#x636E;&#x90FD;&#x65E0;&#x6CD5;&#x4ECE;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x4E2D;&#x76F4;&#x63A5;&#x83B7;&#x53D6;&#x5230;&#xFF0C;&#x800C;&#x662F;&#x9700;&#x8981;&#x5BA2;&#x6237;&#x7AEF;&#x4E3B;&#x52A8;&#x91CD;&#x65B0;&#x53BB;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F; ZooKeeper &#x7684; Watcher &#x673A;&#x5236;&#x7684;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x7279;&#x6027;&#x3002;</p>
<p>&#x53E6;&#x5916;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5411;&#x670D;&#x52A1;&#x7AEF;&#x6CE8;&#x518C; Watcher &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x628A;&#x5BA2;&#x6237;&#x7AEF;&#x771F;&#x5B9E;&#x7684; Watcher &#x5BF9;&#x8C61;&#x4F20;&#x9012;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x4EC5;&#x4EC5;&#x53EA;&#x662F;&#x5728;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x4E2D;&#x4F7F;&#x7528; boolean &#x7C7B;&#x578B;&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x4E86;&#x6807;&#x8BB0;&#xFF0C;&#x540C;&#x65F6;&#x670D;&#x52A1;&#x7AEF;&#x4E5F;&#x4EC5;&#x4EC5;&#x53EA;&#x662F;&#x4FDD;&#x5B58;&#x4E86;&#x5F53;&#x524D;&#x8FDE;&#x63A5;&#x7684; ServerCnxn &#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x6837;&#x8F7B;&#x91CF;&#x7EA7;&#x7684; Watcher &#x673A;&#x5236;&#x8BBE;&#x8BA1;&#xFF0C;&#x5728;&#x7F51;&#x7EDC;&#x5F00;&#x9500;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x5185;&#x5B58;&#x5F00;&#x9500;&#x4E0A;&#x90FD;&#x662F;&#x975E;&#x5E38;&#x5EC9;&#x4EF7;&#x7684;&#x3002;</p>
<p>Watches are maintained locally at the ZooKeeper server to which the client is connected. This allows watches to be lightweight to set, maintain, and dispatch. When a client connects to a new server, the watch will be triggered for any session events. Watches will not be received while disconnected from a server. When a client reconnects, any previously registered watches will be reregistered and triggered if needed. In general this all occurs transparently. There is one case where a watch may be missed: a watch for the existence of a znode not yet created will be missed if the znode is created and deleted while disconnected.</p>
<h3 id="what-zookeeper-guarantees-about-watches">What ZooKeeper Guarantees about Watches</h3>
<p>With regard to watches, ZooKeeper maintains these guarantees:</p>
<p>&#x5BF9;&#x4E8E;watch&#xFF0C;ZooKeeper&#x63D0;&#x4F9B;&#x4E86;&#x8FD9;&#x4E9B;&#x4FDD;&#x969C;&#xFF1A;</p>
<ul>
<li>Watches are ordered with respect to other events, other watches, and asynchronous replies. The ZooKeeper client libraries ensures that everything is dispatched in order.</li>
</ul>
<p>Watch&#x4E0E;&#x5176;&#x4ED6;&#x4E8B;&#x4EF6;&#x3001;&#x5176;&#x4ED6;watch&#x4EE5;&#x53CA;&#x5F02;&#x6B65;&#x56DE;&#x590D;&#x90FD;&#x662F;&#x6709;&#x5E8F;&#x7684;&#x3002;ZooKeeper&#x5BA2;&#x6237;&#x7AEF;&#x5E93;&#x4FDD;&#x8BC1;&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#x90FD;&#x4F1A;&#x6309;&#x987A;&#x5E8F;&#x5206;&#x53D1;&#x3002;</p>
<ul>
<li>A client will see a watch event for a znode it is watching before seeing the new data that corresponds to that znode.</li>
</ul>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x4FDD;&#x969C;&#x5B83;&#x5728;&#x770B;&#x5230;&#x76F8;&#x5E94;&#x7684;znode&#x7684;&#x65B0;&#x6570;&#x636E;&#x4E4B;&#x524D;&#x63A5;&#x6536;&#x5230;watch&#x4E8B;&#x4EF6;&#x3002;</p>
<ul>
<li>The order of watch events from ZooKeeper corresponds to the order of the updates as seen by the ZooKeeper service.</li>
</ul>
<p>&#x4ECE;ZooKeeper&#x63A5;&#x6536;&#x5230;&#x7684;watch&#x4E8B;&#x4EF6;&#x987A;&#x5E8F;&#x4E00;&#x5B9A;&#x548C;ZooKeeper&#x670D;&#x52A1;&#x6240;&#x770B;&#x5230;&#x7684;&#x4E8B;&#x4EF6;&#x987A;&#x5E8F;&#x662F;&#x4E00;&#x81F4;&#x7684;&#x3002;</p>
<h3 id="things-to-remember-about-watches">Things to Remember about Watches</h3>
<p>&#x5173;&#x4E8E;Watch&#x7684;&#x4E00;&#x4E9B;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x4E8B;&#x60C5;</p>
<ul>
<li>Watches are one time triggers; if you get a watch event and you want to get notified of future changes, you must set another watch.</li>
</ul>
<p>Watch&#x662F;&#x4E00;&#x6B21;&#x6027;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5F97;&#x5230;&#x4E86;&#x4E00;&#x4E2A;watch&#x4E8B;&#x4EF6;&#xFF0C;&#x800C;&#x4F60;&#x5E0C;&#x671B;&#x5728;&#x4EE5;&#x540E;&#x53D1;&#x751F;&#x53D8;&#x66F4;&#x65F6;&#x7EE7;&#x7EED;&#x5F97;&#x5230;&#x901A;&#x77E5;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x518D;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;watch&#x3002;</p>
<ul>
<li>Because watches are one time triggers and there is latency between getting the event and sending a new request to get a watch you cannot reliably see every change that happens to a node in ZooKeeper. Be prepared to handle the case where the znode changes multiple times between getting the event and setting the watch again. (You may not care, but at least realize it may happen.)</li>
</ul>
<p>&#x56E0;&#x4E3A;watch&#x662F;&#x4E00;&#x6B21;&#x6027;&#x89E6;&#x53D1;&#x5668;&#xFF0C;&#x800C;&#x83B7;&#x5F97;&#x4E8B;&#x4EF6;&#x518D;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x8BBE;&#x7F6E;watch&#x7684;&#x8BF7;&#x6C42;&#x8FD9;&#x4E00;&#x8FC7;&#x7A0B;&#x4F1A;&#x6709;&#x5EF6;&#x65F6;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x65E0;&#x6CD5;&#x786E;&#x4FDD;&#x4F60;&#x770B;&#x5230;&#x4E86;&#x6240;&#x6709;&#x53D1;&#x751F;&#x5728;ZooKeeper&#x4E0A;&#x7684;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x7684;&#x4E8B;&#x4EF6;&#x3002;&#x6240;&#x4EE5;&#x8BF7;&#x5904;&#x7406;&#x597D;&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x95F4;&#x7A97;&#x53E3;&#x4E2D;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x591A;&#x6B21;znode&#x53D8;&#x66F4;&#x7684;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x3002;&#xFF08;&#x4F60;&#x53EF;&#x4EE5;&#x4E0D;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x81F3;&#x5C11;&#x8BF7;&#x8BA4;&#x8BC6;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#xFF09;&#x3002;</p>
<ul>
<li>A watch object, or function/context pair, will only be triggered once for a given notification. For example, if the same watch object is registered for an exists and a getData call for the same file and that file is then deleted, the watch object would only be invoked once with the deletion notification for the file.</li>
</ul>
<p>&#x4E00;&#x4E2A;watch&#x5BF9;&#x8C61;&#x6216;&#x4E00;&#x4E2A;&#x51FD;&#x6570;/&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#xFF0C;&#x4E3A;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#x53EA;&#x4F1A;&#x88AB;&#x901A;&#x77E5;&#x4E00;&#x6B21;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x540C;&#x4E00;&#x4E2A;watch&#x5BF9;&#x8C61;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x4E0A;&#x5206;&#x522B;&#x901A;&#x8FC7;exists&#x548C;getData&#x6CE8;&#x518C;&#x4E86;&#x4E24;&#x6B21;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x4E4B;&#x540E;&#x88AB;&#x5220;&#x9664;&#x4E86;&#xFF0C;&#x8FD9;&#x65F6;&#x8FD9;&#x4E2A;watch&#x5BF9;&#x8C61;&#x5C06;&#x53EA;&#x4F1A;&#x6536;&#x5230;&#x4E00;&#x6B21;&#x8BE5;&#x6587;&#x4EF6;&#x7684;deletion&#x901A;&#x77E5;&#x3002;</p>
<ul>
<li>When you disconnect from a server (for example, when the server fails), you will not get any watches until the connection is reestablished. For this reason session events are sent to all outstanding watch handlers. Use session events to go into a safe mode: you will not be receiving events while disconnected, so your process should act conservatively in that mode.</li>
</ul>
<p>&#x5F53;&#x4F60;&#x4ECE;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x65AD;&#x5F00;&#x65F6;&#xFF08;&#x6BD4;&#x5982;&#x670D;&#x52A1;&#x5668;&#x51FA;&#x6545;&#x969C;&#x4E86;&#xFF09;&#xFF0C;&#x5728;&#x518D;&#x6B21;&#x8FDE;&#x63A5;&#x4E0A;&#x4E4B;&#x524D;&#xFF0C;&#x4F60;&#x5C06;&#x65E0;&#x6CD5;&#x83B7;&#x5F97;&#x4EFB;&#x4F55;watch&#x3002;&#x8BF7;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x4F1A;&#x8BDD;&#x4E8B;&#x4EF6;&#x6765;&#x8FDB;&#x5165;&#x5B89;&#x5168;&#x6A21;&#x5F0F;&#xFF1A;&#x5728;disconnected&#x72B6;&#x6001;&#x4E0B;&#x4F60;&#x5C06;&#x4E0D;&#x4F1A;&#x6536;&#x5230;&#x4E8B;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x5728;&#x6B64;&#x671F;&#x95F4;&#x5E94;&#x8BE5;&#x8C28;&#x614E;&#x884C;&#x4E8B;&#x3002;</p>
<h3 id="curator&#x4F7F;&#x7528;">Curator&#x4F7F;&#x7528;</h3>
<p>Curator&#x662F;Netflix&#x516C;&#x53F8;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x7684;zookeeper&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5728;&#x539F;&#x751F;API&#x63A5;&#x53E3;&#x4E0A;&#x8FDB;&#x884C;&#x4E86;&#x5305;&#x88C5;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x5F88;&#x591A;ZooKeeper&#x5BA2;&#x6237;&#x7AEF;&#x975E;&#x5E38;&#x5E95;&#x5C42;&#x7684;&#x7EC6;&#x8282;&#x5F00;&#x53D1;&#x3002;&#x540C;&#x65F6;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x4E86;&#x8BF8;&#x5982;Session&#x8D85;&#x65F6;&#x91CD;&#x8FDE;&#xFF0C;Watcher&#x53CD;&#x590D;&#x6CE8;&#x518C;&#x7B49;&#x529F;&#x80FD;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;Fluent&#x98CE;&#x683C;&#x7684;API&#x63A5;&#x53E3;&#xFF0C;&#x662F;&#x4F7F;&#x7528;&#x6700;&#x5E7F;&#x6CDB;&#x7684;zookeeper&#x5BA2;&#x6237;&#x7AEF;&#x4E4B;&#x4E00;&#x3002;</p>
<h4 id="curator&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x79CD;watchercache&#x6765;&#x76D1;&#x542C;&#x7ED3;&#x70B9;&#x7684;&#x53D8;&#x5316;&#xFF1A;">Curator&#x63D0;&#x4F9B;&#x4E86;&#x4E09;&#x79CD;Watcher(Cache)&#x6765;&#x76D1;&#x542C;&#x7ED3;&#x70B9;&#x7684;&#x53D8;&#x5316;&#xFF1A;</h4>
<p>Curator&#x662F;Netflix&#x516C;&#x53F8;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x7684;zookeeper&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5728;&#x539F;&#x751F;API&#x63A5;&#x53E3;&#x4E0A;&#x8FDB;&#x884C;&#x4E86;&#x5305;&#x88C5;&#xFF0C;&#x89E3;&#x51B3;&#x4E86;&#x5F88;&#x591A;ZooKeeper&#x5BA2;&#x6237;&#x7AEF;&#x975E;&#x5E38;&#x5E95;&#x5C42;&#x7684;&#x7EC6;&#x8282;&#x5F00;&#x53D1;&#x3002;&#x540C;&#x65F6;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x4E86;&#x8BF8;&#x5982;Session&#x8D85;&#x65F6;&#x91CD;&#x8FDE;&#xFF0C;Watcher&#x53CD;&#x590D;&#x6CE8;&#x518C;&#x7B49;&#x529F;&#x80FD;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;Fluent&#x98CE;&#x683C;&#x7684;API&#x63A5;&#x53E3;&#xFF0C;&#x662F;&#x4F7F;&#x7528;&#x6700;&#x5E7F;&#x6CDB;&#x7684;zookeeper&#x5BA2;&#x6237;&#x7AEF;&#x4E4B;&#x4E00;&#x3002;</p>
<h5 id="path-cache">Path Cache</h5>
<p>A Path Cache is used to watch a ZNode. Whenever a child is added, updated or removed, the Path Cache will change its state to contain the current set of children, the children&apos;s data and the children&apos;s state. Path caches in the Curator Framework are provided by the PathChildrenCache class. Changes to the path are passed to registered PathChildrenCacheListener instances.</p>
<p>&#x5BF9;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x8282;&#x70B9;&#x7684;&#x4E00;&#x7EA7;&#x5B50;&#x76EE;&#x5F55;&#x76D1;&#x542C;&#xFF0C;&#x4E0D;&#x5BF9;&#x8BE5;&#x8282;&#x70B9;&#x7684;&#x64CD;&#x4F5C;&#x76D1;&#x542C;&#xFF0C;&#x5BF9;&#x5176;&#x5B50;&#x76EE;&#x5F55;&#x7684;&#x589E;&#x5220;&#x6539;&#x64CD;&#x4F5C;&#x76D1;&#x542C;&#x3002;&#x5982;&#x679C;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x5220;&#x9664;&#x540E;&#x53C8;&#x521B;&#x5EFA;&#xFF0C;Watcher&#x5931;&#x6548;&#x3002;</p>
<h5 id="node-cache">Node Cache</h5>
<p>A utility that attempts to keep the data from a node locally cached. This class will watch the node, respond to update/create/delete events, pull down the data, etc. You can register a listener that will get notified when changes occur.</p>
<p>&#x5BF9;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x76D1;&#x542C;&#xFF0C;&#x76D1;&#x542C;&#x4E8B;&#x4EF6;&#x5305;&#x62EC;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x7684;&#x589E;&#x5220;&#x6539;&#x64CD;&#x4F5C;&#x3002;&#x5982;&#x679C;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x5220;&#x9664;&#x540E;&#x53C8;&#x521B;&#x5EFA;&#xFF0C;Watcher&#x7EE7;&#x7EED;&#x751F;&#x6548;&#x3002;</p>
<h5 id="tree-cache">Tree Cache</h5>
<p>A utility that attempts to keep all data from all children of a ZK path locally cached. This class will watch the ZK path, respond to update/create/delete events, pull down the data, etc. You can register a listener that will get notified when changes occur.</p>
<p>&#x7EFC;&#x5408;NodeCache&#x548C;PathChildrenCahce&#x7684;&#x7279;&#x6027;&#xFF0C;&#x662F;&#x5BF9;&#x6574;&#x4E2A;&#x76EE;&#x5F55;&#x8FDB;&#x884C;&#x76D1;&#x542C;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x76D1;&#x542C;&#x6DF1;&#x5EA6;&#x3002;&#x5982;&#x679C;&#x6307;&#x5B9A;&#x8DEF;&#x5F84;&#x5220;&#x9664;&#x540E;&#x53C8;&#x521B;&#x5EFA;&#xFF0C;Watcher&#x7EE7;&#x7EED;&#x751F;&#x6548;&#x3002;</p>
<h4 id="curator&#x7684;&#x4E00;&#x4E9B;&#x6D4B;&#x8BD5;">Curator&#x7684;&#x4E00;&#x4E9B;&#x6D4B;&#x8BD5;</h4>
<p>&#xFF08;1&#xFF09;&#x6D4B;&#x8BD5; Curator &#x7684; pathcache&#xFF0C;&#x662F;&#x5426;&#x591A;&#x4E2A;&#x53EA;&#x89E6;&#x53D1;&#x4E00;&#x6B21;&#xFF1F;</p>
<p>&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x88AB;&#x6DFB;&#x52A0;&#x591A;&#x6B21;&#xFF0C;&#x5219;&#x89E6;&#x53D1;&#x4E00;&#x6B21;&#x3002;&#x82E5;&#x6709;&#x591A;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5219;&#x89E6;&#x53D1;&#x591A;&#x6B21;&#xFF01;</p>
<p>&#xFF08;2&#xFF09;&#x6D4B;&#x8BD5; pathcache &#x662F;&#x5426;&#x968F;&#x8282;&#x70B9;&#x7684;&#x6D88;&#x5931;&#x800C;&#x6D88;&#x5931;&#xFF1F;</p>
<p>nodecache&#x5728;&#x8282;&#x70B9;&#x5220;&#x9664;&#x540E;&#x518D;&#x521B;&#x5EFA;&#xFF0C;&#x80FD;&#x6062;&#x590D;&#x3002;pathcache&#x5219;&#x6C38;&#x8FDC;&#x6D88;&#x5931;&#x3002;</p>
<p>TreeCache=NodeCache+PathCache&#xFF0C;&#x5220;&#x9664;&#x540E;&#x518D;&#x521B;&#x5EFA;&#xFF0C;&#x53EF;&#x4EE5;&#x6062;&#x590D;&#xFF01;&#xFF01;&#xFF01;</p>
<p>&#xFF08;3&#xFF09;&#x6D4B;&#x8BD5; CONNECTIONLOSS &#x4E0E; SESSIONEXPIRED</p>
<p>CONNECTIONLOSS&#xFF0C;&#x4E0D;&#x7528;&#x64CD;&#x4F5C;</p>
<p>SESSIONEXPIRED&#xFF0C;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;</p>
<h4 id="&#x53D1;&#x73B0;-zookeeper-&#x7684;-bug&#xFF1F;&#x53CD;&#x6B63;&#x7279;&#x522B;&#x626F;">&#x53D1;&#x73B0; Zookeeper &#x7684; bug&#xFF1F;&#x53CD;&#x6B63;&#x7279;&#x522B;&#x626F;</h4>
<p>addAuthInfo &#x6388;&#x6743;&#x64CD;&#x4F5C;&#xFF0C;&#x6B64;&#x5904;&#x4F1A;&#x89E6;&#x53D1;&#x5F53;&#x524D;&#x8FDE;&#x63A5;&#x7684;&#x6240;&#x6709;&#x8DEF;&#x5F84;&#x7684;&#x5B50;&#x8282;&#x70B9;&#x521B;&#x5EFA;&#x4E8B;&#x4EF6;&#xFF01;&#xFF01;&#xFF01;</p>
<h3 id="&#x53C2;&#x8003;&#x8D44;&#x6599;">&#x53C2;&#x8003;&#x8D44;&#x6599;</h3>
<h4 id="1-zookeeper-watches">1. ZooKeeper Watches</h4>
<p><a href="http://zookeeper.apache.org/doc/r3.1.2/zookeeperProgrammers.html#ch_zkWatches" target="_blank">http://zookeeper.apache.org/doc/r3.1.2/zookeeperProgrammers.html#ch_zkWatches</a></p>
<h4 id="2-&#x3010;apache-zookeeper&#x3011;&#x7406;&#x89E3;zookeeper&#x4E2D;&#x7684;watches">2. &#x3010;Apache ZooKeeper&#x3011;&#x7406;&#x89E3;ZooKeeper&#x4E2D;&#x7684;Watches</h4>
<p><a href="https://blog.csdn.net/ganglia/article/details/11720737" target="_blank">https://blog.csdn.net/ganglia/article/details/11720737</a></p>
<h4 id="3-caches">3. Caches</h4>
<p><a href="http://curator.apache.org/curator-recipes/index.html" target="_blank">http://curator.apache.org/curator-recipes/index.html</a></p>
<h4 id="4-zookeeper-watch&#x673A;&#x5236;">4. ZooKeeper Watch&#x673A;&#x5236;</h4>
<p><a href="http://danylolivia.iteye.com/blog/2341343" target="_blank">http://danylolivia.iteye.com/blog/2341343</a></p>
<h4 id="5-apache-zookeeper-watcher-&#x673A;&#x5236;&#x6E90;&#x7801;&#x89E3;&#x91CA;">5. Apache ZooKeeper Watcher &#x673A;&#x5236;&#x6E90;&#x7801;&#x89E3;&#x91CA;</h4>
<p><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-apache-zookeeper-watcher/" target="_blank">https://www.ibm.com/developerworks/cn/opensource/os-cn-apache-zookeeper-watcher/</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="ZooKeeper权限控制.html" class="navigation navigation-prev " aria-label="Previous page: 6.2 ZooKeeper权限控制">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="ZooKeeper连接.html" class="navigation navigation-next " aria-label="Next page: 6.4 ZooKeeper连接">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"6.3 ZooKeeperWatcher","level":"1.7.3","depth":2,"next":{"title":"6.4 ZooKeeper连接","level":"1.7.4","depth":2,"path":"zookeeper/ZooKeeper连接.md","ref":"zookeeper/ZooKeeper连接.md","articles":[]},"previous":{"title":"6.2 ZooKeeper权限控制","level":"1.7.2","depth":2,"path":"zookeeper/ZooKeeper权限控制.md","ref":"zookeeper/ZooKeeper权限控制.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"zookeeper/ZooKeeperWatcher.md","mtime":"2018-05-31T02:13:06.348Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-06-26T13:49:56.226Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

